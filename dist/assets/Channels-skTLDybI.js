import{u as _,j as J,k as m,D as Q,d as X,l as ee,E as te,g as S,h as se,q as ae,c,a as s,t as f,F as W,p as V,b as D,m as b,x as B,v as T,G as ne,H as $,A as M,o as d,y as le,z as ie,_ as oe}from"./index-CH_LaoES.js";const re="/assets/sprite-BbW-irAG.svg",ce=_(),{setUser:de}=ce,ue=J("channels",{state:()=>({channels:null,whales:null,myChannels:null}),getters:{getChannels:a=>a.myChannels},actions:{async fetchChannels(){const a=_(),o=await m.get("https://taptaptap.coinclicker.app/channels",{headers:{"x-api-key":a.getAccessToken}});console.log(o),this.channels=o.data},async fetchWhales(){const a=_(),o=await m.get("https://taptaptap.coinclicker.app/whales",{headers:{"x-api-key":a.getAccessToken}});this.whales=o.data,console.log(o.data)},async startChannel(a){const o=_(),e=await m.post("https://taptaptap.coinclicker.app/initUserChannel",{id:a.id},{headers:{"x-api-key":o.getAccessToken}});return this.myChannels=e.data.channels,!0},async createWhale(a,o,e){const g=_(),p=await m.post("https://taptaptap.coinclicker.app/createWhale",{title:a,link:o,rewarded:e},{headers:{"x-api-key":g.getAccessToken}});return console.log(p),!!p.data.sucess},async getMyChannels(){const a=_(),o=await m.get("https://taptaptap.coinclicker.app/getMyChannels",{headers:{"x-api-key":a.getAccessToken}});console.log(o),this.myChannels=Q(o.data.channels)},async rewardChannel(a){const o=_(),e=await m.post("https://taptaptap.coinclicker.app/getRewardFromChannel",{id:a.id},{headers:{"x-api-key":o.getAccessToken}});return console.log(e.data),de(e.data.user),this.myChannels=e.data.channels,!0},async changeChannelAvailable(a){const o=_(),e=await m.post("https://taptaptap.coinclicker.app/changeChannelAvailable",{id:a},{headers:{"x-api-key":o.getAccessToken}});return console.log(e.data),!0},async deleteWhale(a){const o=_(),e=await m.post("https://taptaptap.coinclicker.app/deleteWhale",{id:a},{headers:{"x-api-key":o.getAccessToken}});return console.log(e.data),!0}}});function G(a){const o=Object.prototype.toString.call(a);return a instanceof Date||typeof a=="object"&&o==="[object Date]"?new a.constructor(+a):typeof a=="number"||o==="[object Number]"||typeof a=="string"||o==="[object String]"?new Date(a):new Date(NaN)}const he=36e5;function pe(a){return o=>{const g=(a?Math[a]:Math.trunc)(o);return g===0?0:g}}function ve(a,o){return+G(a)-+G(o)}function fe(a,o,e){const g=ve(a,o)/he;return pe(e==null?void 0:e.roundingMethod)(g)}const _e="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width='80px'%20height='80px'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M15%2012L12%2012M12%2012L9%2012M12%2012L12%209M12%2012L12%2015'%20stroke='%23878787'%20stroke-width='1.5'%20stroke-linecap='round'/%3e%3cpath%20d='M7%203.33782C8.47087%202.48697%2010.1786%202%2012%202C17.5228%202%2022%206.47715%2022%2012C22%2017.5228%2017.5228%2022%2012%2022C6.47715%2022%202%2017.5228%202%2012C2%2010.1786%202.48697%208.47087%203.33782%207'%20stroke='%23878787'%20stroke-width='1.5'%20stroke-linecap='round'/%3e%3c/svg%3e",x=a=>(le("data-v-3ffd80f7"),a=a(),ie(),a),N=re+"#chevron-right",we={class:"telegram-channels"},ye={class:"earn-title"},ge={style:{display:"flex",flexDirection:"column",justifyContent:"space-between"}},me={style:{height:"40vh"}},ke={class:"channels-title"},Ce={key:0,class:"channels-list"},be=["onClick"],xe={class:"channel-info"},Se={class:"name"},Ae={class:"channel-action"},Te={key:0,class:"reward"},Le={key:1},Ie=x(()=>s("svg",{class:"arrow"},[s("use",{"xlink:href":N})],-1)),De={style:{display:"flex",justifyContent:"space-between"}},$e={class:"channels-title"},Me=["src"],Re={key:0,class:"channels-list",style:{height:"40vh",overflowY:"scroll"}},je=["onClick"],Ue={class:"channel-info",style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"}},We=["src"],Ve={key:1,style:{height:"30px",width:"30px",borderRadius:"100px",background:"gray",justifyContent:"center",alignItems:"center",display:"flex"}},Be={class:"name",style:{marginLeft:"10px"}},Ge={key:2},Ne={class:"channel-action"},Ee={key:0,class:"reward"},Fe={key:1},ze=x(()=>s("svg",{class:"arrow"},[s("use",{"xlink:href":N})],-1)),He={class:"popup-content"},Pe={class:"popup-header"},qe=x(()=>s("svg",{class:"close-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 30 30",width:"16px",height:"16px"},[s("path",{d:"M 7 4 C 6.744125 4 6.4879687 4.0974687 6.2929688 4.2929688 L 4.2929688 6.2929688 C 3.9019687 6.6839688 3.9019687 7.3170313 4.2929688 7.7070312 L 11.585938 15 L 4.2929688 22.292969 C 3.9019687 22.683969 3.9019687 23.317031 4.2929688 23.707031 L 6.2929688 25.707031 C 6.6839688 26.098031 7.3170313 26.098031 7.7070312 25.707031 L 15 18.414062 L 22.292969 25.707031 C 22.682969 26.098031 23.317031 26.098031 23.707031 25.707031 L 25.707031 23.707031 C 26.098031 23.316031 26.098031 22.682969 25.707031 22.292969 L 18.414062 15 L 25.707031 7.7070312 C 26.098031 7.3170312 26.098031 6.6829688 25.707031 6.2929688 L 23.707031 4.2929688 C 23.316031 3.9019687 22.682969 3.9019687 22.292969 4.2929688 L 15 11.585938 L 7.7070312 4.2929688 C 7.5115312 4.0974687 7.255875 4 7 4 z"})],-1)),Ye=[qe],Ke={key:0,class:"popup-body"},Oe={key:1,class:"popup-body"},Ze=x(()=>s("p",null,"Этот канал принадлежит вам",-1)),Je={style:{marginTop:"15px"}},Qe={style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},Xe=x(()=>s("label",{for:"fname"},"Название канала",-1)),et={style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},tt=x(()=>s("label",{for:"fname"},"Ссылка на канал",-1)),st={style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},at=x(()=>s("label",{for:"fname"},"Цена за переход",-1)),nt=X({__name:"Channels",setup(a){const{t:o}=ee(),e=ue(),g=te(),p=S(!1),L=S(!1),R=_(),w=S(-1),l=S({id:0,title:"",reward:0,invite_link:"",status:"",createdAt:"",owner_id:0,available:!1,is_available:!1}),A=()=>{e.fetchChannels().then(()=>{e.getMyChannels().then(()=>{var i,h,u,n;((i=e.myChannels)==null?void 0:i.length)!=null&&((h=e.myChannels)==null?void 0:h.length)>0&&((u=e.myChannels)==null||u.map(r=>{var C,U;if(console.log(r),r.Status=="init"){let y=(C=e.channels)==null?void 0:C.findIndex(I=>I.id==r.ChannelID);e.channels&&y!=null&&y!=-1&&(e.channels[y].is_available=!0,console.log(e.channels[y].is_available))}if(r.Status=="rewarded"){let y=(U=e.channels)==null?void 0:U.findIndex(I=>I.id==r.ChannelID);e.channels&&y!=null&&y!=-1&&(e.channels[y].is_available=!1,console.log(e.channels[y].is_available))}}));let t=[];(n=e.channels)==null||n.map(r=>{r.is_whale&&t.push(r)}),e.whales=t.length>0?t:[],t.sort((r,C)=>r.user_id===w.value&&C.user_id!==w.value?-1:r.user_id!==w.value&&C.user_id===w.value?1:0),console.log(e.whales),L.value=!0})})};se(()=>{var t,i;A(),((t=R.user)==null?void 0:t.id)!=null&&(w.value=(i=R.user)==null?void 0:i.id)});const j=(t,i)=>{var h,u,n;if(!t.available&&t.user_id!=w.value){console.log("channel is not available"),M().showAlert(o("Канал недоступен"));return}if(((h=e.myChannels)==null?void 0:h.length)!=null&&((u=e.myChannels)==null?void 0:u.length)>0){let r=e.myChannels.findIndex(C=>C.ChannelID==t.id);console.log(r),r!=-1?(l.value.status=e.myChannels[r].Status,l.value.createdAt=((n=e.myChannels[r].CreatedAt)==null?void 0:n.toLocaleString())||""):(l.value.status="",l.value.createdAt="")}console.log(e.myChannels),l.value.id=t.id,l.value.owner_id=t.user_id,l.value.reward=t.reward,l.value.title=t.title,l.value.invite_link=t.invite_link,l.value.available=t.available,l.value.is_available=t.is_available,p.value=!1,k.value=i,setTimeout(F,100)},E=()=>{const t={id:l.value.id,title:l.value.title,invite_link:l.value.invite_link,available:!0,reward:0,is_available:!0,channel_avatar:"",is_whale:!1,user_id:0};e.startChannel(t).then(i=>{if(i){p.value=!1,e.getMyChannels();try{g.openTelegramLink(l.value.invite_link)}catch{console.log("Err")}}})},F=()=>{p.value=!0};function z(){k.value!="create"&&(p.value=!1)}const H=()=>{console.log("check time: "+l.value.createdAt);const t=new Date(l.value.createdAt),h=fe(new Date,t);if(console.log("check time: "+l.value.createdAt),console.log("Hours since request: "+h),h>=0){const u={id:l.value.id,title:l.value.title,invite_link:l.value.invite_link,reward:0,is_available:!0,available:!0,channel_avatar:"",is_whale:!1,user_id:0};e.rewardChannel(u).then(()=>{if(console.log("request finished"),p.value=!1,e.channels){var n=e.channels.findIndex(r=>r.id==l.value.id);e.channels[n].is_available=!1}l.value.status="",l.value.createdAt=""})}else M().showAlert(o("earn.waitRewardText"))},k=S("visible"),P=()=>{console.log(11111111),k.value="create",p.value=!0},v=S({title:"",link:"",rewared:0});function q(t){return/^(https?:\/\/)?(www\.)?t\.me\/[a-zA-Z0-9_]{5,}$/.test(t)}async function Y(){if(!(v.value.title===""||v.value.link===""||v.value.rewared===0)){if(!q(v.value.link)){console.error("Invalid Telegram URL format"),M().showAlert(o("Invalid Telegram URL format"));return}e.createWhale(v.value.title,v.value.link,v.value.rewared).then(t=>{t&&(A(),p.value=!1)})}}const K=t=>{t.target.blur()},O=t=>{var h;const i=(h=e.whales)==null?void 0:h.findIndex(u=>u.id==t);i!=-1&&i!=null&&e.whales!=null&&e.whales[i].id==t&&e.changeChannelAvailable(t).then(u=>{u&&(p.value=!1,A())})},Z=t=>{var h;const i=(h=e.whales)==null?void 0:h.findIndex(u=>u.id==t);i!=-1&&i!=null&&e.whales!=null&&e.whales[i].id==t&&e.deleteWhale(t).then(u=>{u&&(p.value=!1,A())})};return(t,i)=>{var u;const h=ae("click-outside");return d(),c("div",we,[s("div",ye," 🤑 "+f(t.$t("earn.name")),1),s("div",ge,[s("div",me,[s("div",ke," 📢 "+f(t.$t("earn.channels")),1),L.value?(d(),c("div",Ce,[(d(!0),c(W,null,V((u=D(e).channels)==null?void 0:u.filter(n=>!n.is_whale),n=>(d(),c("div",{key:n.id,onClick:r=>n.is_available?j(n,"visible"):null,class:"channel"},[s("div",xe,[s("span",Se,f(n.title),1)]),s("div",Ae,[n.is_available?(d(),c("span",Te,"🍆 "+f(n.reward.toLocaleString()),1)):(d(),c("span",Le,"Награда получена")),Ie])],8,be))),128))])):b("",!0)]),s("div",null,[s("div",De,[s("div",$e," 🐳 "+f(t.$t("whales.channels")),1),s("div",{style:{display:"flex",alignItems:"center"},onClick:P},[s("img",{src:D(_e),alt:"Your Icon",style:{height:"45px",marginRight:"7px"}},null,8,Me)])]),L.value?(d(),c("div",Re,[(d(!0),c(W,null,V(D(e).whales,n=>(d(),c("div",{key:n.id,onClick:r=>n.is_available?j(n,"visible"):null,class:B(n.available?"channel":"channel-disable")},[s("div",Ue,[n.channel_avatar!=""?(d(),c("img",{key:0,src:n.channel_avatar,style:{height:"30px",borderRadius:"100px"}},null,8,We)):(d(),c("div",Ve,"🐳")),s("span",Be,f(n.title),1),n.user_id==w.value?(d(),c("span",Ge,"👑")):b("",!0)]),s("div",Ne,[n.is_available?(d(),c("span",Ee,"🍆 "+f(n.reward.toLocaleString()),1)):(d(),c("span",Fe,"Награда получена")),ze])],10,je))),128))])):b("",!0)])]),p.value?(d(),c("div",{key:0,class:B(["boost-purchase-popup",{visible:p.value}])},[T((d(),c("div",He,[s("div",Pe,[s("h2",null,f(k.value=="create"?"Create whale":"Earn coins"),1),s("button",{class:"close-button",onClick:i[0]||(i[0]=n=>{p.value=!1})},Ye)]),k.value=="visible"&&l.value.owner_id!=w.value?(d(),c("div",Ke,[s("p",null,f(l.value.status=="init"?t.$t("earn.waitRewardText"):t.$t("earn.selectedChannel")),1),s("p",null,"🍆"+f(l.value.reward),1),s("button",{class:"boost-purchase-button",onClick:i[1]||(i[1]=n=>l.value.status=="init"?H():E())},f(l.value.status=="init"?t.$t("earn.getRewardButton"):t.$t("earn.startRewardButton")),1)])):b("",!0),k.value=="visible"&&l.value.owner_id==w.value?(d(),c("div",Oe,[Ze,s("p",null,"Награда за переход: 🍆"+f(l.value.reward),1),s("div",Je,[s("button",{class:"boost-purchase-button",onClick:i[2]||(i[2]=n=>O(l.value.id))},f(l.value.available?"Остановить":"Включить"),1),s("button",{class:"boost-purchase-button",style:{marginTop:"15px"},onClick:i[3]||(i[3]=n=>Z(l.value.id))},"Удалить")])])):b("",!0),k.value=="create"?(d(),c("div",{key:2,class:"popup-body",onKeydown:ne(K,["enter"]),style:{overflowY:"scroll"}},[s("div",Qe,[Xe,T(s("input",{type:"text",id:"fname",style:{width:"100%"},name:"fname","onUpdate:modelValue":i[4]||(i[4]=n=>v.value.title=n)},null,512),[[$,v.value.title]])]),s("div",et,[tt,T(s("input",{type:"text",id:"fname",style:{width:"100%"},name:"fname","onUpdate:modelValue":i[5]||(i[5]=n=>v.value.link=n)},null,512),[[$,v.value.link]])]),s("div",st,[at,T(s("input",{type:"number",id:"fname",style:{width:"100%"},name:"fname","onUpdate:modelValue":i[6]||(i[6]=n=>v.value.rewared=n)},null,512),[[$,v.value.rewared]])]),s("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},[s("button",{class:"mypost-button",style:{marginTop:"30px",width:"100%"},onClick:Y},"Создать")])],32)):b("",!0)])),[[h,z]])],2)):b("",!0)])}}}),it=oe(nt,[["__scopeId","data-v-3ffd80f7"]]);export{it as default};
