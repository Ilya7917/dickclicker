import{u as y,j as J,k as m,D as Q,d as X,l as ee,E as te,g as S,h as se,q as ae,c,a,t as f,F as W,p as V,b as A,m as C,x as B,v as D,G as ne,H as j,A as $,o as u,y as le,z as ie,_ as oe}from"./index-uAA1DASL.js";const re="/assets/sprite-BbW-irAG.svg",ce=y(),{setUser:ue}=ce,de=J("channels",{state:()=>({channels:null,whales:null,myChannels:null}),getters:{getChannels:n=>n.myChannels},actions:{async fetchChannels(){const n=y(),o=await m.get("https://taptaptap.coinclicker.app/channels",{headers:{"x-api-key":n.getAccessToken}});console.log(o),this.channels=o.data},async fetchWhales(){const n=y(),o=await m.get("https://taptaptap.coinclicker.app/whales",{headers:{"x-api-key":n.getAccessToken}});this.whales=o.data,console.log(o.data)},async startChannel(n){const o=y(),e=await m.post("https://taptaptap.coinclicker.app/initUserChannel",{id:n.id},{headers:{"x-api-key":o.getAccessToken}});return this.myChannels=e.data.channels,!0},async createWhale(n,o,e){const g=y(),v=await m.post("https://taptaptap.coinclicker.app/createWhale",{title:n,link:o,rewarded:e},{headers:{"x-api-key":g.getAccessToken}});return console.log(v),!!v.data.sucess},async getMyChannels(){const n=y(),o=await m.get("https://taptaptap.coinclicker.app/getMyChannels",{headers:{"x-api-key":n.getAccessToken}});console.log(o),this.myChannels=Q(o.data.channels)},async rewardChannel(n){const o=y(),e=await m.post("https://taptaptap.coinclicker.app/getRewardFromChannel",{id:n.id},{headers:{"x-api-key":o.getAccessToken}});return console.log(e.data),ue(e.data.user),this.myChannels=e.data.channels,!0},async changeChannelAvailable(n){const o=y(),e=await m.post("https://taptaptap.coinclicker.app/changeChannelAvailable",{id:n},{headers:{"x-api-key":o.getAccessToken}});return console.log(e.data),!0},async deleteWhale(n){const o=y(),e=await m.post("https://taptaptap.coinclicker.app/deleteWhale",{id:n},{headers:{"x-api-key":o.getAccessToken}});return console.log(e.data),!0}}});function G(n){const o=Object.prototype.toString.call(n);return n instanceof Date||typeof n=="object"&&o==="[object Date]"?new n.constructor(+n):typeof n=="number"||o==="[object Number]"||typeof n=="string"||o==="[object String]"?new Date(n):new Date(NaN)}const he=36e5;function ve(n){return o=>{const g=(n?Math[n]:Math.trunc)(o);return g===0?0:g}}function pe(n,o){return+G(n)-+G(o)}function fe(n,o,e){const g=pe(n,o)/he;return ve(e==null?void 0:e.roundingMethod)(g)}const _e="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width='80px'%20height='80px'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M15%2012L12%2012M12%2012L9%2012M12%2012L12%209M12%2012L12%2015'%20stroke='%23878787'%20stroke-width='1.5'%20stroke-linecap='round'/%3e%3cpath%20d='M7%203.33782C8.47087%202.48697%2010.1786%202%2012%202C17.5228%202%2022%206.47715%2022%2012C22%2017.5228%2017.5228%2022%2012%2022C6.47715%2022%202%2017.5228%202%2012C2%2010.1786%202.48697%208.47087%203.33782%207'%20stroke='%23878787'%20stroke-width='1.5'%20stroke-linecap='round'/%3e%3c/svg%3e",x=n=>(le("data-v-f65072e1"),n=n(),ie(),n),N=re+"#chevron-right",we={class:"telegram-channels"},ye={class:"earn-title"},ge={style:{display:"flex",flexDirection:"column",justifyContent:"space-between"}},ke={style:{height:"40vh"}},me={class:"channels-title"},Ce={key:0,class:"channels-list"},be=["onClick"],xe={class:"channel-info"},Se={class:"name"},Ae={class:"channel-action"},Te={key:0,class:"reward"},Le={key:1},Ie=x(()=>a("svg",{class:"arrow"},[a("use",{"xlink:href":N})],-1)),De={style:{display:"flex",justifyContent:"space-between"}},$e={class:"channels-title"},Me=["src"],Re={key:0,class:"channels-list",style:{height:"40vh",overflowY:"scroll"}},je=["onClick"],Ue={class:"channel-info",style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"}},We=["src"],Ve={key:1,style:{height:"30px",width:"30px",borderRadius:"100px",background:"gray",justifyContent:"center",alignItems:"center",display:"flex"}},Be={class:"name",style:{marginLeft:"10px"}},Ge={key:2},Ne={class:"channel-action"},Fe={key:0,class:"reward"},ze={key:1},Ee=x(()=>a("svg",{class:"arrow"},[a("use",{"xlink:href":N})],-1)),He={class:"popup-content"},Pe={class:"popup-header"},qe=x(()=>a("svg",{class:"close-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 30 30",width:"16px",height:"16px"},[a("path",{d:"M 7 4 C 6.744125 4 6.4879687 4.0974687 6.2929688 4.2929688 L 4.2929688 6.2929688 C 3.9019687 6.6839688 3.9019687 7.3170313 4.2929688 7.7070312 L 11.585938 15 L 4.2929688 22.292969 C 3.9019687 22.683969 3.9019687 23.317031 4.2929688 23.707031 L 6.2929688 25.707031 C 6.6839688 26.098031 7.3170313 26.098031 7.7070312 25.707031 L 15 18.414062 L 22.292969 25.707031 C 22.682969 26.098031 23.317031 26.098031 23.707031 25.707031 L 25.707031 23.707031 C 26.098031 23.316031 26.098031 22.682969 25.707031 22.292969 L 18.414062 15 L 25.707031 7.7070312 C 26.098031 7.3170312 26.098031 6.6829688 25.707031 6.2929688 L 23.707031 4.2929688 C 23.316031 3.9019687 22.682969 3.9019687 22.292969 4.2929688 L 15 11.585938 L 7.7070312 4.2929688 C 7.5115312 4.0974687 7.255875 4 7 4 z"})],-1)),Ye=[qe],Ke={key:0,class:"popup-body"},Oe={key:1,class:"popup-body"},Ze=x(()=>a("p",null,"Этот канал принадлежит вам",-1)),Je={style:{marginTop:"15px"}},Qe={style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},Xe=x(()=>a("label",{for:"fname"},"Название канала",-1)),et={style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},tt=x(()=>a("label",{for:"fname"},"Ссылка на канал",-1)),st={style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},at=x(()=>a("label",{for:"fname"},"Цена за переход",-1)),nt=X({__name:"Channels",setup(n){const{t:o}=ee(),e=de(),g=te(),v=S(!1),M=S(!1),T=y(),_=S(-1),l=S({id:0,title:"",reward:0,invite_link:"",status:"",createdAt:"",owner_id:0,available:!1,is_available:!1}),L=()=>{e.fetchChannels().then(()=>{e.getMyChannels().then(()=>{var i,h,d,w;((i=e.myChannels)==null?void 0:i.length)!=null&&((h=e.myChannels)==null?void 0:h.length)>0&&((d=e.myChannels)==null||d.map(r=>{var s,I;if(console.log(r),r.Status=="init"){let k=(s=e.channels)==null?void 0:s.findIndex(R=>R.id==r.ChannelID);e.channels&&k!=null&&k!=-1&&(e.channels[k].is_available=!0,console.log(e.channels[k].is_available))}if(r.Status=="rewarded"){let k=(I=e.channels)==null?void 0:I.findIndex(R=>R.id==r.ChannelID);e.channels&&k!=null&&k!=-1&&(e.channels[k].is_available=!1,console.log(e.channels[k].is_available))}}));let t=[];(w=e.channels)==null||w.map(r=>{r.is_whale&&t.push(r)}),e.whales=t.length>0?t:[],t.sort((r,s)=>r.user_id===_.value&&s.user_id!==_.value?-1:r.user_id!==_.value&&s.user_id===_.value?1:r.is_available&&!s.is_available?-1:!r.is_available&&s.is_available?1:r.available&&!s.available?-1:!r.available&&s.available?1:0),console.log(e.whales),M.value=!0})})};se(()=>{var t,i;L(),((t=T.user)==null?void 0:t.id)!=null&&(_.value=(i=T.user)==null?void 0:i.id)});const U=(t,i)=>{var h,d,w;if(!t.available&&t.user_id!=_.value){console.log("channel is not available"),$().showAlert(o("У кита закончился баланс 🍆"));return}if(((h=e.myChannels)==null?void 0:h.length)!=null&&((d=e.myChannels)==null?void 0:d.length)>0){let r=e.myChannels.findIndex(s=>s.ChannelID==t.id);console.log(r),r!=-1?(l.value.status=e.myChannels[r].Status,l.value.createdAt=((w=e.myChannels[r].CreatedAt)==null?void 0:w.toLocaleString())||""):(l.value.status="",l.value.createdAt="")}console.log(e.myChannels),l.value.id=t.id,l.value.owner_id=t.user_id,l.value.reward=t.reward,l.value.title=t.title,l.value.invite_link=t.invite_link,l.value.available=t.available,l.value.is_available=t.is_available,v.value=!1,b.value=i,setTimeout(z,100)},F=()=>{const t={id:l.value.id,title:l.value.title,invite_link:l.value.invite_link,available:!0,reward:0,is_available:!0,channel_avatar:"",is_whale:!1,user_id:0};e.startChannel(t).then(i=>{if(i){v.value=!1,e.getMyChannels();try{g.openTelegramLink(l.value.invite_link)}catch{console.log("Err")}}})},z=()=>{v.value=!0};function E(){b.value!="create"&&(v.value=!1)}const H=()=>{console.log("check time: "+l.value.createdAt);const t=new Date(l.value.createdAt),h=fe(new Date,t);if(console.log("check time: "+l.value.createdAt),console.log("Hours since request: "+h),h>=1){const d={id:l.value.id,title:l.value.title,invite_link:l.value.invite_link,reward:0,is_available:!0,available:!0,channel_avatar:"",is_whale:!1,user_id:0};e.rewardChannel(d).then(()=>{if(console.log("request finished"),v.value=!1,e.channels){var w=e.channels.findIndex(r=>r.id==l.value.id);e.channels[w].is_available=!1}l.value.status="",l.value.createdAt=""})}else $().showAlert(o("earn.waitRewardText"))},b=S("visible"),P=()=>{console.log(11111111),b.value="create",v.value=!0},p=S({title:"",link:"",rewared:0});function q(t){return/^(https?:\/\/)?(www\.)?t\.me\/[a-zA-Z0-9_]{5,}$/.test(t)}async function Y(){if(!(p.value.title===""||p.value.link===""||p.value.rewared===0)){if(!q(p.value.link)){console.error("Invalid Telegram URL format"),$().showAlert(o("Invalid Telegram URL format"));return}if(e.channels!=null&&e.channels.findIndex(i=>i.user_id==_.value)!=-1){$().showAlert(o("Вы не можете создать больше 1 кита"));return}e.createWhale(p.value.title,p.value.link,p.value.rewared).then(t=>{t&&(L(),v.value=!1)})}}const K=t=>{t.target.blur()},O=t=>{var h;const i=(h=e.whales)==null?void 0:h.findIndex(d=>d.id==t);i!=-1&&i!=null&&e.whales!=null&&e.whales[i].id==t&&e.changeChannelAvailable(t).then(d=>{d&&(v.value=!1,L())})},Z=t=>{var h;const i=(h=e.whales)==null?void 0:h.findIndex(d=>d.id==t);i!=-1&&i!=null&&e.whales!=null&&e.whales[i].id==t&&e.deleteWhale(t).then(d=>{d&&(v.value=!1,L())})};return(t,i)=>{var d,w,r;const h=ae("click-outside");return u(),c("div",we,[a("div",ye," 🤑 "+f(t.$t("earn.name")),1),a("div",ge,[a("div",ke,[a("div",me," 📢 "+f(t.$t("earn.channels")),1),M.value?(u(),c("div",Ce,[(u(!0),c(W,null,V((d=A(e).channels)==null?void 0:d.filter(s=>!s.is_whale),s=>(u(),c("div",{key:s.id,onClick:I=>s.is_available?U(s,"visible"):null,class:"channel"},[a("div",xe,[a("span",Se,f(s.title),1)]),a("div",Ae,[s.is_available?(u(),c("span",Te,"🍆 "+f(s.reward.toLocaleString()),1)):(u(),c("span",Le,"Награда получена")),Ie])],8,be))),128))])):C("",!0)]),a("div",null,[a("div",De,[a("div",$e," 🐳 "+f(t.$t("whales.channels")),1),a("div",{style:{display:"flex",alignItems:"center"},onClick:P},[a("img",{src:A(_e),alt:"Your Icon",style:{height:"45px",marginRight:"7px"}},null,8,Me)])]),M.value?(u(),c("div",Re,[(u(!0),c(W,null,V(A(e).whales,s=>(u(),c("div",{key:s.id,onClick:I=>s.is_available?U(s,"visible"):A(g).openTelegramLink(s.invite_link),class:B(s.available?"channel":"channel-disable")},[a("div",Ue,[s.channel_avatar!=""?(u(),c("img",{key:0,src:s.channel_avatar,style:{height:"30px",borderRadius:"100px"}},null,8,We)):(u(),c("div",Ve,"🐳")),a("span",Be,f(s.title),1),s.user_id==_.value?(u(),c("span",Ge,"👑")):C("",!0)]),a("div",Ne,[s.is_available?(u(),c("span",Fe,"🍆 "+f(s.reward.toLocaleString()),1)):(u(),c("span",ze,"Награда получена")),Ee])],10,je))),128))])):C("",!0)])]),v.value?(u(),c("div",{key:0,class:B(["boost-purchase-popup",{visible:v.value}])},[D((u(),c("div",He,[a("div",Pe,[a("h2",null,f(b.value=="create"?"Create whale":l.value.title),1),a("button",{class:"close-button",onClick:i[0]||(i[0]=s=>{v.value=!1})},Ye)]),b.value=="visible"&&l.value.owner_id!=_.value?(u(),c("div",Ke,[a("p",null,f(l.value.status=="init"?t.$t("earn.waitRewardText"):t.$t("earn.selectedChannel")),1),a("p",null,"🍆"+f(l.value.reward),1),a("button",{class:"boost-purchase-button",onClick:i[1]||(i[1]=s=>l.value.status=="init"?H():F())},f(l.value.status=="init"?t.$t("earn.getRewardButton"):t.$t("earn.startRewardButton")),1)])):C("",!0),b.value=="visible"&&l.value.owner_id==_.value?(u(),c("div",Oe,[Ze,a("p",null,"Награда за переход: 🍆"+f(l.value.reward),1),a("div",Je,[a("button",{class:"boost-purchase-button",onClick:i[2]||(i[2]=s=>O(l.value.id))},f(l.value.available?"Остановить":"Включить"),1),!l.value.available&&((w=A(T).user)==null?void 0:w.balance)!=null&&((r=A(T).user)==null?void 0:r.balance)<=l.value.reward?(u(),c("button",{key:0,class:"boost-purchase-button",style:{marginTop:"15px"},onClick:i[3]||(i[3]=s=>Z(l.value.id))},"Удалить")):C("",!0)])])):C("",!0),b.value=="create"?(u(),c("div",{key:2,class:"popup-body",onKeydown:ne(K,["enter"]),style:{overflowY:"scroll"}},[a("div",Qe,[Xe,D(a("input",{type:"text",id:"fname",style:{width:"100%"},name:"fname","onUpdate:modelValue":i[4]||(i[4]=s=>p.value.title=s)},null,512),[[j,p.value.title]])]),a("div",et,[tt,D(a("input",{type:"text",id:"fname",style:{width:"100%"},name:"fname","onUpdate:modelValue":i[5]||(i[5]=s=>p.value.link=s)},null,512),[[j,p.value.link]])]),a("div",st,[at,D(a("input",{type:"number",id:"fname",style:{width:"100%"},name:"fname","onUpdate:modelValue":i[6]||(i[6]=s=>p.value.rewared=s)},null,512),[[j,p.value.rewared]])]),a("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},[a("button",{class:"mypost-button",style:{marginTop:"30px",width:"100%"},onClick:Y},"Создать")])],32)):C("",!0)])),[[h,E]])],2)):C("",!0)])}}}),it=oe(nt,[["__scopeId","data-v-f65072e1"]]);export{it as default};
