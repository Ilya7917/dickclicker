import{u as k,j as le,k as S,D as ie,d as oe,l as re,E as ue,r as b,o as ce,q as de,c as r,t as h,m as p,e as n,F as N,p as z,v as $,G as L,g as x,x as E,H as ve,A as w,b as u,y as pe,z as he,_ as fe}from"./index-BLUXTQ07.js";import{A as ye,_ as _e}from"./addIcon-DfWGE30F.js";const we=k(),{setUser:me}=we,ge=le("channels",{state:()=>({channels:null,whales:null,myChannels:null}),getters:{getChannels:i=>i.myChannels},actions:{async fetchChannels(){const i=k(),l=await S.get("https://taptaptap.coinclicker.app/channels",{headers:{"x-api-key":i.getAccessToken}});console.log(l),this.channels=l.data},async fetchWhales(){const i=k(),l=await S.get("https://taptaptap.coinclicker.app/whales",{headers:{"x-api-key":i.getAccessToken}});this.whales=l.data,console.log(l.data)},async startChannel(i){const l=k(),t=await S.post("https://taptaptap.coinclicker.app/initUserChannel",{id:i.id},{headers:{"x-api-key":l.getAccessToken}});return this.myChannels=t.data.channels,!0},async createWhale(i,l,t){var j;const f=k(),y=await S.post("https://taptaptap.coinclicker.app/createWhale",{balance:i,link:l,rewarded:t},{headers:{"x-api-key":f.getAccessToken}});return console.log(y),y.data.sucess?(((j=f.user)==null?void 0:j.balance)!=null&&(f.user.balance-=i),!0):!1},async getMyChannels(){const i=k(),l=await S.get("https://taptaptap.coinclicker.app/getMyChannels",{headers:{"x-api-key":i.getAccessToken}});console.log(l),this.myChannels=ie(l.data.channels)},async rewardChannel(i){const l=k(),t=await S.post("https://taptaptap.coinclicker.app/getRewardFromChannel",{id:i.id},{headers:{"x-api-key":l.getAccessToken}});return console.log(t.data),me(t.data.user),this.myChannels=t.data.channels,!0},async changeChannelAvailable(i){const l=k(),t=await S.post("https://taptaptap.coinclicker.app/changeChannelAvailable",{id:i},{headers:{"x-api-key":l.getAccessToken}});return console.log(t.data),!0},async deleteWhale(i){const l=k(),t=await S.post("https://taptaptap.coinclicker.app/deleteWhale",{id:i},{headers:{"x-api-key":l.getAccessToken}});return console.log(t.data),!0},async topUpWhale(i,l){const t=k(),f=await S.post("https://taptaptap.coinclicker.app/topUpWhale",{id:i,balance:l},{headers:{"x-api-key":t.getAccessToken}});return console.log(f.data),!0}}});function K(i){const l=Object.prototype.toString.call(i);return i instanceof Date||typeof i=="object"&&l==="[object Date]"?new i.constructor(+i):typeof i=="number"||l==="[object Number]"||typeof i=="string"||l==="[object String]"?new Date(i):new Date(NaN)}const be=36e5;function ke(i){return l=>{const f=(i?Math[i]:Math.trunc)(l);return f===0?0:f}}function xe(i,l){return+K(i)-+K(l)}function Ce(i,l,t){const f=xe(i,l)/be;return ke(t==null?void 0:t.roundingMethod)(f)}const C=i=>(pe("data-v-372e76a2"),i=i(),he(),i),O=_e+"#chevron-right",Ae={class:"telegram-channels"},Te={key:0,class:"earn-title"},Se={key:1,class:"createPostMenu"},Ie={style:{marginTop:"20px"}},$e={id:"progressbar"},De={class:"createForm"},Le={key:0,style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}},je=C(()=>n("label",{for:"fname"},"Ссылка на канал",-1)),Ue={key:1,style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}},Re=C(()=>n("label",{for:"fname"},"Цена за переход",-1)),We={key:2,style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}},Me=C(()=>n("label",{for:"fname"},"Баланс рекламного канала",-1)),Ve={key:0},Be={key:1,style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",marginTop:"15px"}},Pe={style:{textAlign:"center"}},Ne={style:{fontSize:"16px"}},ze={key:0,style:{display:"flex",justifyContent:"center"}},Ee={key:2,style:{display:"flex",flexDirection:"column",justifyContent:"space-between"}},Fe={style:{height:"40vh"}},He={class:"channels-title"},qe={key:0,class:"channels-list"},Ye=["onClick"],Ge={class:"channel-info",style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"}},Ke=["src"],Oe={key:1,style:{height:"30px",width:"30px",borderRadius:"100px",background:"gray",justifyContent:"center",alignItems:"center",display:"flex"}},Ze={class:"name",style:{marginLeft:"10px"}},Je={class:"channel-action"},Qe={key:0,class:"reward"},Xe={key:1},et=C(()=>n("svg",{class:"arrow"},[n("use",{"xlink:href":O})],-1)),tt={style:{display:"flex",justifyContent:"space-between"}},at={class:"channels-title"},nt=["src"],st={key:0,class:"channels-list",style:{height:"40vh",overflowY:"scroll"}},lt=["onClick"],it={class:"channel-info",style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"}},ot=["src"],rt={key:1,style:{height:"30px",width:"30px",borderRadius:"100px",background:"gray",justifyContent:"center",alignItems:"center",display:"flex"}},ut={class:"name",style:{marginLeft:"10px"}},ct={key:2},dt={class:"channel-action"},vt={key:0,class:"reward"},pt={key:1},ht=C(()=>n("svg",{class:"arrow"},[n("use",{"xlink:href":O})],-1)),ft={class:"popup-content"},yt={class:"popup-header"},_t=C(()=>n("svg",{class:"close-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 30 30",width:"16px",height:"16px"},[n("path",{d:"M 7 4 C 6.744125 4 6.4879687 4.0974687 6.2929688 4.2929688 L 4.2929688 6.2929688 C 3.9019687 6.6839688 3.9019687 7.3170313 4.2929688 7.7070312 L 11.585938 15 L 4.2929688 22.292969 C 3.9019687 22.683969 3.9019687 23.317031 4.2929688 23.707031 L 6.2929688 25.707031 C 6.6839688 26.098031 7.3170313 26.098031 7.7070312 25.707031 L 15 18.414062 L 22.292969 25.707031 C 22.682969 26.098031 23.317031 26.098031 23.707031 25.707031 L 25.707031 23.707031 C 26.098031 23.316031 26.098031 22.682969 25.707031 22.292969 L 18.414062 15 L 25.707031 7.7070312 C 26.098031 7.3170312 26.098031 6.6829688 25.707031 6.2929688 L 23.707031 4.2929688 C 23.316031 3.9019687 22.682969 3.9019687 22.292969 4.2929688 L 15 11.585938 L 7.7070312 4.2929688 C 7.5115312 4.0974687 7.255875 4 7 4 z"})],-1)),wt=[_t],mt={key:0,class:"popup-body"},gt={key:1,class:"popup-body"},bt={key:0},kt={key:1},xt={key:2},Ct={key:3,style:{marginTop:"15px"}},At={key:4,style:{marginTop:"15px"}},Tt=C(()=>n("span",null,"Насколько желаете пополнить кита?🐳",-1)),St={style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},It=C(()=>n("label",{for:"fname"},"Баланс кита",-1)),$t={style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},Dt=C(()=>n("label",{for:"fname"},"Цена за переход",-1)),Lt={style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},jt=C(()=>n("label",{for:"fname"},"Ссылка на канал",-1)),Ut=oe({__name:"Channels",setup(i){const{t:l}=re(),t=ge(),f=ue(),y=b(!1),j=b(!1),I=k(),_=b(0),o=b({id:0,title:"",reward:0,balance:0,invite_link:"",status:"",createdAt:"",owner_id:0,available:!1,is_available:!1}),R=()=>{t.fetchChannels().then(()=>{t.getMyChannels().then(()=>{var a,v,d,g;((a=t.myChannels)==null?void 0:a.length)!=null&&((v=t.myChannels)==null?void 0:v.length)>0&&((d=t.myChannels)==null||d.map(e=>{var m,G;if(console.log(e),e.Status=="init"){let T=(m=t.channels)==null?void 0:m.findIndex(P=>P.id==e.ChannelID);t.channels&&T!=null&&T!=-1&&(t.channels[T].is_available=!0,console.log(t.channels[T].is_available))}if(e.Status=="rewarded"){let T=(G=t.channels)==null?void 0:G.findIndex(P=>P.id==e.ChannelID);t.channels&&T!=null&&T!=-1&&(t.channels[T].is_available=!1,console.log(t.channels[T].is_available))}}));let s=[];(g=t.channels)==null||g.map(e=>{e.is_whale&&s.push(e)}),t.whales=s.length>0?s:[],s.sort((e,m)=>e.user_id===_.value&&m.user_id!==_.value?-1:e.user_id!==_.value&&m.user_id===_.value?1:e.available&&!m.available?-1:!e.available&&m.available?1:e.is_available&&!m.is_available?-1:!e.is_available&&m.is_available?1:0),console.log(t.whales),j.value=!0})})};ce(()=>{var s,a;R(),((s=I.user)==null?void 0:s.id)!=null&&(_.value=(a=I.user)==null?void 0:a.id)});const F=(s,a)=>{var v,d,g;if(!s.available&&s.user_id!=_.value){console.log("channel is not available"),w().showAlert(l("У кита закончился баланс 🍆")),f.openTelegramLink(s.invite_link);return}if(((v=t.myChannels)==null?void 0:v.length)!=null&&((d=t.myChannels)==null?void 0:d.length)>0){let e=t.myChannels.findIndex(m=>m.ChannelID==s.id);console.log(e),e!=-1?(o.value.status=t.myChannels[e].Status,o.value.createdAt=((g=t.myChannels[e].CreatedAt)==null?void 0:g.toLocaleString())||""):(o.value.status="",o.value.createdAt="")}console.log(t.myChannels),o.value.id=s.id,o.value.balance=s.balance,o.value.owner_id=s.user_id,o.value.reward=s.reward,o.value.title=s.title,o.value.invite_link=s.invite_link,o.value.available=s.available,o.value.is_available=s.is_available,y.value=!1,U.value=a,setTimeout(J,100)},Z=()=>{const s={id:o.value.id,title:o.value.title,invite_link:o.value.invite_link,available:!0,reward:0,balance:0,is_available:!0,channel_avatar:"",is_whale:!1,user_id:0};t.startChannel(s).then(a=>{if(a){y.value=!1,t.getMyChannels();try{f.openTelegramLink(o.value.invite_link)}catch{console.log("Err")}}})},J=()=>{y.value=!0};function Q(){U.value!="create"&&(y.value=!1)}const X=()=>{console.log("check time: "+o.value.createdAt);const s=new Date(o.value.createdAt),v=Ce(new Date,s);if(console.log("check time: "+o.value.createdAt),console.log("Hours since request: "+v),v>=1){const d={id:o.value.id,title:o.value.title,invite_link:o.value.invite_link,reward:0,is_available:!0,available:!0,balance:0,channel_avatar:"",is_whale:!1,user_id:0};t.rewardChannel(d).then(()=>{if(console.log("request finished"),y.value=!1,t.channels){var g=t.channels.findIndex(e=>e.id==o.value.id);t.channels[g].is_available=!1}o.value.status="",o.value.createdAt=""})}else w().showAlert(l("earn.waitRewardText"))},U=b("visible"),c=b({balance:0,link:"",rewared:0});function H(s){return/^(https?:\/\/)?(www\.)?t\.me\/[a-zA-Z0-9_]{5,}$/.test(s)}async function q(){var s,a;if(!(c.value.link===""||c.value.rewared==0)){if(!H(c.value.link)){console.error("Invalid Telegram URL format"),w().showAlert(l("Invalid Telegram URL format"));return}if(I.user!=null&&c.value.balance>((s=I.user)==null?void 0:s.balance)){w().showAlert(l("У вас недостаточно 🍆 чтобы поместить их в рекламу канала"));return}if(c.value.balance==0){w().showAlert(l("Баланс канала рекламы не может быть 0🍆"));return}if(c.value.balance<1e4){w().showAlert(l("Баланс рекламы канала не может быть меньше 10.000🍆"));return}if(c.value.rewared>c.value.balance){w().showAlert(l("❌ Вы не можете выдавать юзерам больше, чем будет на балансе рекламы канала ❌"));return}if(t.channels!=null&&t.channels.findIndex(d=>d.user_id==_.value)!=-1){let d=t.channels.filter(g=>g.user_id==_.value).length;if(d>0&&I.user!=null&&((a=I.user)==null?void 0:a.balance)<d*1e4+c.value.balance){w().showAlert(l("У вас недостаточно 🍆 чтобы создать ещё один рекламный канал"));return}}V.value=!1,t.createWhale(c.value.balance,c.value.link,c.value.rewared).then(v=>{v?(R(),y.value=!1,V.value=!0,M.value="channels",A.value=0,B.forEach(d=>{d.id!=0&&(d.isActive=!1)})):(w().showAlert(l("🐳 Ошибка при создании канала, попробуйте попытку позже")),V.value=!0)})}}const ee=s=>{s.target.blur()},te=s=>{var v;const a=(v=t.whales)==null?void 0:v.findIndex(d=>d.id==s);a!=-1&&a!=null&&t.whales!=null&&t.whales[a].id==s&&t.changeChannelAvailable(s).then(d=>{d&&(y.value=!1,R())})},ae=s=>{var v;const a=(v=t.whales)==null?void 0:v.findIndex(d=>d.id==s);a!=-1&&a!=null&&t.whales!=null&&t.whales[a].id==s&&t.deleteWhale(s).then(d=>{d&&(y.value=!1,R())})},D=b("view"),W=b(0),ne=s=>{if(I.user!=null){if(W.value==0){w().showAlert(l("Нельзя пополнить на 0 🍆"));return}if(I.user.balance<W.value){w().showAlert(l("У вас недостаточно 🍆 чтобы поместить их в рекламу канала"));return}t.topUpWhale(s,W.value).then(a=>{a&&(y.value=!1,D.value="view",R())})}},M=b("channels"),A=b(0),Y=s=>{M.value=s},V=b(!0),B=[{id:0,isActive:!0,text:"Add link"},{id:1,isActive:!1,text:"Price per transition"},{id:2,isActive:!1,text:"Add balance"}],se=()=>{if(A.value==0&&!H(c.value.link)){w().showAlert(l("Invalid Telegram URL format"));return}if(A.value==1){if(c.value.rewared<=0){w().showAlert(l("❌ Цена за переход не может быть меньше 0 🍆 ❌"));return}if(c.value.rewared<500){w().showAlert(l("❌ Цена за переход не может быть меньше 500 🍆 ❌"));return}}A.value++,B[A.value].isActive=!0};return(s,a)=>{var d,g;const v=de("click-outside");return u(),r("div",Ae,[M.value!="create"?(u(),r("div",Te," 🤑 "+h(s.$t("earn.name")),1)):p("",!0),M.value==="create"?(u(),r("div",Se,[n("button",{class:"mypost-button",style:{marginTop:"10px"},onClick:a[0]||(a[0]=e=>Y("channels"))},"Назад"),n("div",Ie,[n("ul",$e,[(u(),r(N,null,z(B,e=>n("li",{class:E(e.isActive?"active":"")},h(e.text),3)),64))])]),n("div",De,[A.value===0?(u(),r("div",Le,[je,$(n("input",{type:"text",id:"fname",style:{width:"70%",color:"white"},name:"fname","onUpdate:modelValue":a[1]||(a[1]=e=>c.value.link=e)},null,512),[[L,c.value.link]])])):p("",!0),A.value===1?(u(),r("div",Ue,[Re,$(n("input",{type:"number",id:"fname",style:{width:"70%",color:"white"},name:"fname","onUpdate:modelValue":a[2]||(a[2]=e=>c.value.rewared=e)},null,512),[[L,c.value.rewared]])])):p("",!0),A.value===2?(u(),r("div",We,[Me,$(n("input",{type:"number",id:"fname",style:{width:"70%",color:"white"},name:"fname","onUpdate:modelValue":a[3]||(a[3]=e=>c.value.balance=e)},null,512),[[L,c.value.balance]]),V.value?(u(),r("div",Ve,[n("button",{class:"mypost-button",style:{marginTop:"30px"},onClick:a[4]||(a[4]=e=>q())},"Создать")])):p("",!0),((d=x(t).whales)==null?void 0:d.findIndex(e=>e.user_id==_.value))!=-1?(u(),r("div",Be,[n("div",Pe,[n("span",Ne,"⚠️ Стоимость создания рекламного канала будет "+h(x(t).whales?x(t).whales.filter(e=>e.user_id==_.value).length*1e4:0)+"🍆, т.к вы уже имеете "+h(x(t).whales?x(t).whales.filter(e=>e.user_id==_.value).length:0)+" канала ⚠️",1)])])):p("",!0)])):p("",!0)]),A.value<2?(u(),r("div",ze,[n("button",{class:"mypost-button",style:{marginTop:"30px"},onClick:se},"Дальше")])):p("",!0)])):p("",!0),M.value=="channels"?(u(),r("div",Ee,[n("div",Fe,[n("div",He," 📢 "+h(s.$t("earn.channels")),1),j.value?(u(),r("div",qe,[(u(!0),r(N,null,z((g=x(t).channels)==null?void 0:g.filter(e=>!e.is_whale),e=>(u(),r("div",{key:e.id,onClick:m=>e.is_available?F(e,"visible"):x(f).openTelegramLink(e.invite_link),class:"channel"},[n("div",Ge,[e.channel_avatar!=""?(u(),r("img",{key:0,src:e.channel_avatar,style:{height:"30px",borderRadius:"100px"}},null,8,Ke)):(u(),r("div",Oe,"📢")),n("span",Ze,h(e.title),1)]),n("div",Je,[e.is_available?(u(),r("span",Qe,"🍆 "+h(e.reward.toLocaleString()),1)):(u(),r("span",Xe,"Награда получена")),et])],8,Ye))),128))])):p("",!0)]),n("div",null,[n("div",tt,[n("div",at," 🐳 "+h(s.$t("whales.channels")),1),n("div",{style:{display:"flex",alignItems:"center"},onClick:a[5]||(a[5]=e=>Y("create"))},[n("img",{src:x(ye),alt:"Your Icon",style:{height:"45px",marginRight:"7px"}},null,8,nt)])]),j.value?(u(),r("div",st,[(u(!0),r(N,null,z(x(t).whales,e=>(u(),r("div",{key:e.id,onClick:m=>e.is_available?F(e,"visible"):x(f).openTelegramLink(e.invite_link),class:E(e.available?"channel":"channel-disable")},[n("div",it,[e.channel_avatar!=""?(u(),r("img",{key:0,src:e.channel_avatar,style:{height:"30px",borderRadius:"100px"}},null,8,ot)):(u(),r("div",rt,"🐳")),n("span",ut,h(e.title),1),e.user_id==_.value?(u(),r("span",ct,"👑")):p("",!0)]),n("div",dt,[e.is_available?(u(),r("span",vt,"🍆 "+h(e.reward.toLocaleString()),1)):(u(),r("span",pt,"Награда получена")),ht])],10,lt))),128))])):p("",!0)])])):p("",!0),y.value?(u(),r("div",{key:3,class:E(["boost-purchase-popup",{visible:y.value}])},[$((u(),r("div",ft,[n("div",yt,[n("h2",null,h(U.value=="create"?"Create whale":o.value.title),1),n("button",{class:"close-button",onClick:a[6]||(a[6]=e=>{y.value=!1})},wt)]),U.value=="visible"&&o.value.owner_id!=_.value?(u(),r("div",mt,[n("p",null,h(o.value.status=="init"?s.$t("earn.waitRewardText"):s.$t("earn.selectedChannel")),1),n("p",null,"🍆"+h(o.value.reward),1),n("button",{class:"boost-purchase-button",onClick:a[7]||(a[7]=e=>o.value.status=="init"?X():Z())},h(o.value.status=="init"?s.$t("earn.getRewardButton"):s.$t("earn.startRewardButton")),1)])):p("",!0),U.value=="visible"&&o.value.owner_id==_.value?(u(),r("div",gt,[D.value=="view"?(u(),r("p",bt,"Этот канал принадлежит вам")):p("",!0),D.value=="view"?(u(),r("p",kt,"Награда за переход: 🍆"+h(o.value.reward),1)):p("",!0),D.value=="view"?(u(),r("p",xt,"Оставшийся баланс рекламы: 🍆"+h(o.value.balance),1)):p("",!0),D.value=="view"?(u(),r("div",Ct,[n("button",{class:"boost-purchase-button",onClick:a[8]||(a[8]=e=>te(o.value.id))},h(o.value.available?"Остановить":"Включить"),1),n("button",{class:"boost-purchase-button",onClick:a[9]||(a[9]=e=>D.value="topUp"),style:{marginTop:"15px"}},"Пополнить"),n("button",{class:"boost-purchase-button",style:{marginTop:"15px"},onClick:a[10]||(a[10]=e=>ae(o.value.id))},"Удалить")])):(u(),r("div",At,[Tt,$(n("input",{type:"number",id:"fname",style:{width:"100%"},name:"fname","onUpdate:modelValue":a[11]||(a[11]=e=>W.value=e)},null,512),[[L,W.value]]),n("button",{class:"boost-purchase-button",onClick:a[12]||(a[12]=e=>ne(o.value.id)),style:{marginTop:"15px"}},"Пополнить"),n("button",{class:"boost-purchase-button",onClick:a[13]||(a[13]=e=>D.value="view"),style:{marginTop:"15px"}},"Назад")]))])):p("",!0),U.value=="create"?(u(),r("div",{key:2,class:"popup-body",onKeydown:ve(ee,["enter"]),style:{overflowY:"scroll"}},[n("div",St,[It,$(n("input",{type:"number",id:"fname",style:{width:"100%"},name:"fname","onUpdate:modelValue":a[14]||(a[14]=e=>c.value.balance=e)},null,512),[[L,c.value.balance]])]),n("div",$t,[Dt,$(n("input",{type:"number",id:"fname",style:{width:"100%"},name:"fname","onUpdate:modelValue":a[15]||(a[15]=e=>c.value.rewared=e)},null,512),[[L,c.value.rewared]])]),n("div",Lt,[jt,$(n("input",{type:"text",id:"fname",style:{width:"100%"},name:"fname","onUpdate:modelValue":a[16]||(a[16]=e=>c.value.link=e)},null,512),[[L,c.value.link]])]),n("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},[n("button",{class:"mypost-button",style:{marginTop:"30px",width:"100%"},onClick:q},"Создать")])],32)):p("",!0)])),[[v,Q]])],2)):p("",!0)])}}}),Mt=fe(Ut,[["__scopeId","data-v-372e76a2"]]);export{Mt as default};
