import{u as g,j as q,k,D as Y,d as K,l as O,E as Z,g as b,h as J,q as Q,c as d,a as s,t as h,F as R,p as j,b as A,m as y,x as X,v as S,G as ee,H as D,A as U,o as u,y as te,z as se,_ as ne}from"./index-BlECUKBz.js";const ae="/assets/sprite-BbW-irAG.svg",le=g(),{setUser:oe}=le,ie=q("channels",{state:()=>({channels:null,whales:null,myChannels:null}),getters:{getChannels:n=>n.myChannels},actions:{async fetchChannels(){const n=g(),o=await k.get("https://taptaptap.coinclicker.app/channels",{headers:{"x-api-key":n.getAccessToken}});this.channels=o.data},async fetchWhales(){const n=g(),o=await k.get("https://taptaptap.coinclicker.app/whales",{headers:{"x-api-key":n.getAccessToken}});this.whales=o.data,console.log(o.data)},async startChannel(n){const o=g(),e=await k.post("https://taptaptap.coinclicker.app/initUserChannel",{id:n.id},{headers:{"x-api-key":o.getAccessToken}});return this.myChannels=e.data.channels,!0},async createWhale(n,o,e){const w=g(),r=await k.post("https://taptaptap.coinclicker.app/createWhale",{title:n,link:o,rewarded:e},{headers:{"x-api-key":w.getAccessToken}});return console.log(r),!!r.data.sucess},async getMyChannels(){const n=g(),o=await k.get("https://taptaptap.coinclicker.app/getMyChannels",{headers:{"x-api-key":n.getAccessToken}});this.myChannels=Y(o.data.channels)},async rewardChannel(n){const o=g(),e=await k.post("https://taptaptap.coinclicker.app/getRewardFromChannel",{id:n.id},{headers:{"x-api-key":o.getAccessToken}});return console.log(e.data),oe(e.data.user),this.myChannels=e.data.channels,!0}}});function V(n){const o=Object.prototype.toString.call(n);return n instanceof Date||typeof n=="object"&&o==="[object Date]"?new n.constructor(+n):typeof n=="number"||o==="[object Number]"||typeof n=="string"||o==="[object String]"?new Date(n):new Date(NaN)}const re=36e5;function ce(n){return o=>{const w=(n?Math[n]:Math.trunc)(o);return w===0?0:w}}function de(n,o){return+V(n)-+V(o)}function ue(n,o,e){const w=de(n,o)/re;return ce(e==null?void 0:e.roundingMethod)(w)}const he="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width='80px'%20height='80px'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M15%2012L12%2012M12%2012L9%2012M12%2012L12%209M12%2012L12%2015'%20stroke='%23878787'%20stroke-width='1.5'%20stroke-linecap='round'/%3e%3cpath%20d='M7%203.33782C8.47087%202.48697%2010.1786%202%2012%202C17.5228%202%2022%206.47715%2022%2012C22%2017.5228%2017.5228%2022%2012%2022C6.47715%2022%202%2017.5228%202%2012C2%2010.1786%202.48697%208.47087%203.33782%207'%20stroke='%23878787'%20stroke-width='1.5'%20stroke-linecap='round'/%3e%3c/svg%3e",x=n=>(te("data-v-4d4eab4b"),n=n(),se(),n),B=ae+"#chevron-right",pe={class:"telegram-channels"},ve={class:"earn-title"},fe={style:{display:"flex",flexDirection:"column",justifyContent:"space-between"}},_e={style:{height:"40vh"}},we={class:"channels-title"},ye={key:0,class:"channels-list"},ge=["onClick"],me={class:"channel-info"},Ce={class:"name"},ke={class:"channel-action"},xe={key:0,class:"reward"},be=x(()=>s("svg",{class:"arrow"},[s("use",{"xlink:href":B})],-1)),Se={style:{display:"flex",justifyContent:"space-between"}},Le={class:"channels-title"},Te=["src"],Ae={key:0,class:"channels-list",style:{height:"40vh",overflowY:"scroll"}},De=["onClick"],Ie={class:"channel-info"},Me={class:"name"},$e={class:"channel-action"},Re={key:0,class:"reward"},je=x(()=>s("svg",{class:"arrow"},[s("use",{"xlink:href":B})],-1)),Ue={class:"popup-content"},Ve={class:"popup-header"},Be=x(()=>s("svg",{class:"close-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 30 30",width:"16px",height:"16px"},[s("path",{d:"M 7 4 C 6.744125 4 6.4879687 4.0974687 6.2929688 4.2929688 L 4.2929688 6.2929688 C 3.9019687 6.6839688 3.9019687 7.3170313 4.2929688 7.7070312 L 11.585938 15 L 4.2929688 22.292969 C 3.9019687 22.683969 3.9019687 23.317031 4.2929688 23.707031 L 6.2929688 25.707031 C 6.6839688 26.098031 7.3170313 26.098031 7.7070312 25.707031 L 15 18.414062 L 22.292969 25.707031 C 22.682969 26.098031 23.317031 26.098031 23.707031 25.707031 L 25.707031 23.707031 C 26.098031 23.316031 26.098031 22.682969 25.707031 22.292969 L 18.414062 15 L 25.707031 7.7070312 C 26.098031 7.3170312 26.098031 6.6829688 25.707031 6.2929688 L 23.707031 4.2929688 C 23.316031 3.9019687 22.682969 3.9019687 22.292969 4.2929688 L 15 11.585938 L 7.7070312 4.2929688 C 7.5115312 4.0974687 7.255875 4 7 4 z"})],-1)),We=[Be],Ge={key:0,class:"popup-body"},Ne={style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},Ee=x(()=>s("label",{for:"fname"},"Название канала",-1)),Fe={style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},ze=x(()=>s("label",{for:"fname"},"Ссылка на канал",-1)),He={style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},Pe=x(()=>s("label",{for:"fname"},"Цена за переход",-1)),qe=K({__name:"Channels",setup(n){const{t:o}=O(),e=ie(),w=Z(),r=b(!1),L=b(!1),l=b({id:0,title:"",reward:0,invite_link:"",status:"",createdAt:""}),I=()=>{e.fetchChannels().then(()=>{e.getMyChannels().then(()=>{var i,p,v,f;((i=e.myChannels)==null?void 0:i.length)!=null&&((p=e.myChannels)==null?void 0:p.length)>0&&((v=e.myChannels)==null||v.map(t=>{var C,$;if(console.log(t),t.Status=="init"){let _=(C=e.channels)==null?void 0:C.findIndex(T=>T.id==t.ChannelID);e.channels&&_!=null&&_!=-1&&(e.channels[_].is_available=!0,console.log(e.channels[_].is_available))}if(t.Status=="rewarded"){let _=($=e.channels)==null?void 0:$.findIndex(T=>T.id==t.ChannelID);e.channels&&_!=null&&_!=-1&&(e.channels[_].is_available=!1,console.log(e.channels[_].is_available))}}));let a=[];(f=e.channels)==null||f.map(t=>{t.is_whale&&a.push(t)}),e.whales=a.length>0?a:[],console.log(e.whales),L.value=!0})})};J(()=>{I()});const M=(a,i)=>{var p,v,f;if(((p=e.myChannels)==null?void 0:p.length)!=null&&((v=e.myChannels)==null?void 0:v.length)>0){let t=e.myChannels.findIndex(C=>C.ChannelID==a.id);console.log(t),t!=-1?(l.value.status=e.myChannels[t].Status,l.value.createdAt=((f=e.myChannels[t].CreatedAt)==null?void 0:f.toLocaleString())||""):(l.value.status="",l.value.createdAt="")}console.log(l),l.value.id=a.id,l.value.reward=a.reward,l.value.title=a.title,l.value.invite_link=a.invite_link,r.value=!1,m.value=i,setTimeout(G,100),console.log(r)},W=()=>{const a={id:l.value.id,title:l.value.title,invite_link:l.value.invite_link,reward:0,is_available:!0,is_whale:!1};e.startChannel(a).then(i=>{if(i){r.value=!1,e.getMyChannels();try{w.openTelegramLink(l.value.invite_link)}catch{console.log("Err")}}})},G=()=>{r.value=!0};function N(){m.value!="create"&&(r.value=!1)}const E=()=>{console.log("check time: "+l.value.createdAt);const a=new Date(l.value.createdAt),p=ue(new Date,a);if(console.log("check time: "+l.value.createdAt),console.log("Hours since request: "+p),p>=1){const v={id:l.value.id,title:l.value.title,invite_link:l.value.invite_link,reward:0,is_available:!0,is_whale:!1};e.rewardChannel(v).then(()=>{if(console.log("request finished"),r.value=!1,e.channels){var f=e.channels.findIndex(t=>t.id==l.value.id);e.channels[f].is_available=!1}l.value.status="",l.value.createdAt=""})}else U().showAlert(o("earn.waitRewardText"))},m=b("visible"),F=()=>{console.log(11111111),m.value="create",r.value=!0},c=b({title:"",link:"",rewared:0});function z(a){return/^(https?:\/\/)?(www\.)?t\.me\/[a-zA-Z0-9_]{5,}$/.test(a)}async function H(){if(!(c.value.title===""||c.value.link===""||c.value.rewared===0)){if(!z(c.value.link)){console.error("Invalid Telegram URL format"),U().showAlert(o("Invalid Telegram URL format"));return}e.createWhale(c.value.title,c.value.link,c.value.rewared).then(a=>{a&&(I(),r.value=!1)})}}const P=a=>{a.target.blur()};return(a,i)=>{var v,f;const p=Q("click-outside");return u(),d("div",pe,[s("div",ve," 🤑 "+h(a.$t("earn.name")),1),s("div",fe,[s("div",_e,[s("div",we," 📢 "+h(a.$t("earn.channels")),1),L.value?(u(),d("div",ye,[(u(!0),d(R,null,j((v=A(e).channels)==null?void 0:v.filter(t=>t.is_available&&!t.is_whale),t=>(u(),d("div",{key:t.id,onClick:C=>M(t,"visible"),class:"channel"},[s("div",me,[s("span",Ce,h(t.title),1)]),s("div",ke,[t.is_available?(u(),d("span",xe,"🍆 "+h(t.reward.toLocaleString()),1)):y("",!0),be])],8,ge))),128))])):y("",!0)]),s("div",null,[s("div",Se,[s("div",Le," 🐳 "+h(a.$t("whales.channels")),1),s("div",{style:{display:"flex",alignItems:"center"},onClick:F},[s("img",{src:A(he),alt:"Your Icon",style:{height:"45px",marginRight:"7px"}},null,8,Te)])]),L.value?(u(),d("div",Ae,[(u(!0),d(R,null,j((f=A(e).whales)==null?void 0:f.filter(t=>t.is_available),t=>(u(),d("div",{key:t.id,onClick:C=>M(t,"visible"),class:"channel"},[s("div",Ie,[s("span",Me,h(t.title),1)]),s("div",$e,[t.is_available?(u(),d("span",Re,"🍆 "+h(t.reward.toLocaleString()),1)):y("",!0),je])],8,De))),128))])):y("",!0)])]),r.value?(u(),d("div",{key:0,class:X(["boost-purchase-popup",{visible:r.value}])},[S((u(),d("div",Ue,[s("div",Ve,[s("h2",null,h(m.value=="create"?"Create whale":"Earn coins"),1),s("button",{class:"close-button",onClick:i[0]||(i[0]=t=>{r.value=!1})},We)]),m.value=="visible"?(u(),d("div",Ge,[s("p",null,h(l.value.status=="init"?a.$t("earn.waitRewardText"):a.$t("earn.selectedChannel")),1),s("p",null,"🍆"+h(l.value.reward),1),s("button",{class:"boost-purchase-button",onClick:i[1]||(i[1]=t=>l.value.status=="init"?E():W())},h(l.value.status=="init"?a.$t("earn.getRewardButton"):a.$t("earn.startRewardButton")),1)])):y("",!0),m.value=="create"?(u(),d("div",{key:1,class:"popup-body",onKeydown:ee(P,["enter"]),style:{overflowY:"scroll"}},[s("div",Ne,[Ee,S(s("input",{type:"text",id:"fname",style:{width:"100%"},name:"fname","onUpdate:modelValue":i[2]||(i[2]=t=>c.value.title=t)},null,512),[[D,c.value.title]])]),s("div",Fe,[ze,S(s("input",{type:"text",id:"fname",style:{width:"100%"},name:"fname","onUpdate:modelValue":i[3]||(i[3]=t=>c.value.link=t)},null,512),[[D,c.value.link]])]),s("div",He,[Pe,S(s("input",{type:"number",id:"fname",style:{width:"100%"},name:"fname","onUpdate:modelValue":i[4]||(i[4]=t=>c.value.rewared=t)},null,512),[[D,c.value.rewared]])]),s("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},[s("button",{class:"mypost-button",style:{marginTop:"30px",width:"100%"},onClick:H},"Создать")])],32)):y("",!0)])),[[p,N]])],2)):y("",!0)])}}}),Ke=ne(qe,[["__scopeId","data-v-4d4eab4b"]]);export{Ke as default};
