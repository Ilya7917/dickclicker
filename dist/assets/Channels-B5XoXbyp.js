import{u as g,j as J,k as m,D as Q,d as X,l as ee,E as te,g as A,h as se,q as ae,c,a,t as f,F as W,p as V,b as x,m as C,x as B,v as D,G as ne,H as j,A as $,o as d,y as le,z as ie,_ as oe}from"./index-DP03_53F.js";const re="/assets/sprite-BbW-irAG.svg",ce=g(),{setUser:de}=ce,ue=J("channels",{state:()=>({channels:null,whales:null,myChannels:null}),getters:{getChannels:n=>n.myChannels},actions:{async fetchChannels(){const n=g(),o=await m.get("https://taptaptap.coinclicker.app/channels",{headers:{"x-api-key":n.getAccessToken}});console.log(o),this.channels=o.data},async fetchWhales(){const n=g(),o=await m.get("https://taptaptap.coinclicker.app/whales",{headers:{"x-api-key":n.getAccessToken}});this.whales=o.data,console.log(o.data)},async startChannel(n){const o=g(),e=await m.post("https://taptaptap.coinclicker.app/initUserChannel",{id:n.id},{headers:{"x-api-key":o.getAccessToken}});return this.myChannels=e.data.channels,!0},async createWhale(n,o,e){const _=g(),p=await m.post("https://taptaptap.coinclicker.app/createWhale",{title:n,link:o,rewarded:e},{headers:{"x-api-key":_.getAccessToken}});return console.log(p),!!p.data.sucess},async getMyChannels(){const n=g(),o=await m.get("https://taptaptap.coinclicker.app/getMyChannels",{headers:{"x-api-key":n.getAccessToken}});console.log(o),this.myChannels=Q(o.data.channels)},async rewardChannel(n){const o=g(),e=await m.post("https://taptaptap.coinclicker.app/getRewardFromChannel",{id:n.id},{headers:{"x-api-key":o.getAccessToken}});return console.log(e.data),de(e.data.user),this.myChannels=e.data.channels,!0},async changeChannelAvailable(n){const o=g(),e=await m.post("https://taptaptap.coinclicker.app/changeChannelAvailable",{id:n},{headers:{"x-api-key":o.getAccessToken}});return console.log(e.data),!0},async deleteWhale(n){const o=g(),e=await m.post("https://taptaptap.coinclicker.app/deleteWhale",{id:n},{headers:{"x-api-key":o.getAccessToken}});return console.log(e.data),!0}}});function G(n){const o=Object.prototype.toString.call(n);return n instanceof Date||typeof n=="object"&&o==="[object Date]"?new n.constructor(+n):typeof n=="number"||o==="[object Number]"||typeof n=="string"||o==="[object String]"?new Date(n):new Date(NaN)}const he=36e5;function pe(n){return o=>{const _=(n?Math[n]:Math.trunc)(o);return _===0?0:_}}function ve(n,o){return+G(n)-+G(o)}function fe(n,o,e){const _=ve(n,o)/he;return pe(e==null?void 0:e.roundingMethod)(_)}const _e="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width='80px'%20height='80px'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M15%2012L12%2012M12%2012L9%2012M12%2012L12%209M12%2012L12%2015'%20stroke='%23878787'%20stroke-width='1.5'%20stroke-linecap='round'/%3e%3cpath%20d='M7%203.33782C8.47087%202.48697%2010.1786%202%2012%202C17.5228%202%2022%206.47715%2022%2012C22%2017.5228%2017.5228%2022%2012%2022C6.47715%2022%202%2017.5228%202%2012C2%2010.1786%202.48697%208.47087%203.33782%207'%20stroke='%23878787'%20stroke-width='1.5'%20stroke-linecap='round'/%3e%3c/svg%3e",S=n=>(le("data-v-9a106545"),n=n(),ie(),n),N=re+"#chevron-right",ye={class:"telegram-channels"},we={class:"earn-title"},ge={style:{display:"flex",flexDirection:"column",justifyContent:"space-between"}},ke={style:{height:"40vh"}},me={class:"channels-title"},Ce={key:0,class:"channels-list"},be=["onClick"],xe={class:"channel-info",style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"}},Se=["src"],Ae={key:1,style:{height:"30px",width:"30px",borderRadius:"100px",background:"gray",justifyContent:"center",alignItems:"center",display:"flex"}},Le={class:"name",style:{marginLeft:"10px"}},Te={class:"channel-action"},Ie={key:0,class:"reward"},De={key:1},$e=S(()=>a("svg",{class:"arrow"},[a("use",{"xlink:href":N})],-1)),Me={style:{display:"flex",justifyContent:"space-between"}},Re={class:"channels-title"},je=["src"],Ue={key:0,class:"channels-list",style:{height:"40vh",overflowY:"scroll"}},We=["onClick"],Ve={class:"channel-info",style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"}},Be=["src"],Ge={key:1,style:{height:"30px",width:"30px",borderRadius:"100px",background:"gray",justifyContent:"center",alignItems:"center",display:"flex"}},Ne={class:"name",style:{marginLeft:"10px"}},Fe={key:2},ze={class:"channel-action"},Ee={key:0,class:"reward"},He={key:1},Pe=S(()=>a("svg",{class:"arrow"},[a("use",{"xlink:href":N})],-1)),qe={class:"popup-content"},Ye={class:"popup-header"},Ke=S(()=>a("svg",{class:"close-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 30 30",width:"16px",height:"16px"},[a("path",{d:"M 7 4 C 6.744125 4 6.4879687 4.0974687 6.2929688 4.2929688 L 4.2929688 6.2929688 C 3.9019687 6.6839688 3.9019687 7.3170313 4.2929688 7.7070312 L 11.585938 15 L 4.2929688 22.292969 C 3.9019687 22.683969 3.9019687 23.317031 4.2929688 23.707031 L 6.2929688 25.707031 C 6.6839688 26.098031 7.3170313 26.098031 7.7070312 25.707031 L 15 18.414062 L 22.292969 25.707031 C 22.682969 26.098031 23.317031 26.098031 23.707031 25.707031 L 25.707031 23.707031 C 26.098031 23.316031 26.098031 22.682969 25.707031 22.292969 L 18.414062 15 L 25.707031 7.7070312 C 26.098031 7.3170312 26.098031 6.6829688 25.707031 6.2929688 L 23.707031 4.2929688 C 23.316031 3.9019687 22.682969 3.9019687 22.292969 4.2929688 L 15 11.585938 L 7.7070312 4.2929688 C 7.5115312 4.0974687 7.255875 4 7 4 z"})],-1)),Oe=[Ke],Ze={key:0,class:"popup-body"},Je={key:1,class:"popup-body"},Qe=S(()=>a("p",null,"Этот канал принадлежит вам",-1)),Xe={style:{marginTop:"15px"}},et={style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},tt=S(()=>a("label",{for:"fname"},"Название канала",-1)),st={style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},at=S(()=>a("label",{for:"fname"},"Ссылка на канал",-1)),nt={style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},lt=S(()=>a("label",{for:"fname"},"Цена за переход",-1)),it=X({__name:"Channels",setup(n){const{t:o}=ee(),e=ue(),_=te(),p=A(!1),M=A(!1),L=g(),y=A(5879286931),l=A({id:0,title:"",reward:0,invite_link:"",status:"",createdAt:"",owner_id:0,available:!1,is_available:!1}),T=()=>{e.fetchChannels().then(()=>{e.getMyChannels().then(()=>{var i,h,u,w;((i=e.myChannels)==null?void 0:i.length)!=null&&((h=e.myChannels)==null?void 0:h.length)>0&&((u=e.myChannels)==null||u.map(r=>{var s,I;if(console.log(r),r.Status=="init"){let k=(s=e.channels)==null?void 0:s.findIndex(R=>R.id==r.ChannelID);e.channels&&k!=null&&k!=-1&&(e.channels[k].is_available=!0,console.log(e.channels[k].is_available))}if(r.Status=="rewarded"){let k=(I=e.channels)==null?void 0:I.findIndex(R=>R.id==r.ChannelID);e.channels&&k!=null&&k!=-1&&(e.channels[k].is_available=!1,console.log(e.channels[k].is_available))}}));let t=[];(w=e.channels)==null||w.map(r=>{r.is_whale&&t.push(r)}),e.whales=t.length>0?t:[],t.sort((r,s)=>r.user_id===y.value&&s.user_id!==y.value?-1:r.user_id!==y.value&&s.user_id===y.value?1:r.is_available&&!s.is_available?-1:!r.is_available&&s.is_available?1:r.available&&!s.available?-1:!r.available&&s.available?1:0),console.log(e.whales),M.value=!0})})};se(()=>{var t,i;T(),((t=L.user)==null?void 0:t.id)!=null&&(y.value=(i=L.user)==null?void 0:i.id)});const U=(t,i)=>{var h,u,w;if(!t.available&&t.user_id!=y.value){console.log("channel is not available"),$().showAlert(o("У кита закончился баланс 🍆"));return}if(((h=e.myChannels)==null?void 0:h.length)!=null&&((u=e.myChannels)==null?void 0:u.length)>0){let r=e.myChannels.findIndex(s=>s.ChannelID==t.id);console.log(r),r!=-1?(l.value.status=e.myChannels[r].Status,l.value.createdAt=((w=e.myChannels[r].CreatedAt)==null?void 0:w.toLocaleString())||""):(l.value.status="",l.value.createdAt="")}console.log(e.myChannels),l.value.id=t.id,l.value.owner_id=t.user_id,l.value.reward=t.reward,l.value.title=t.title,l.value.invite_link=t.invite_link,l.value.available=t.available,l.value.is_available=t.is_available,p.value=!1,b.value=i,setTimeout(z,100)},F=()=>{const t={id:l.value.id,title:l.value.title,invite_link:l.value.invite_link,available:!0,reward:0,is_available:!0,channel_avatar:"",is_whale:!1,user_id:0};e.startChannel(t).then(i=>{if(i){p.value=!1,e.getMyChannels();try{_.openTelegramLink(l.value.invite_link)}catch{console.log("Err")}}})},z=()=>{p.value=!0};function E(){b.value!="create"&&(p.value=!1)}const H=()=>{console.log("check time: "+l.value.createdAt);const t=new Date(l.value.createdAt),h=fe(new Date,t);if(console.log("check time: "+l.value.createdAt),console.log("Hours since request: "+h),h>=1){const u={id:l.value.id,title:l.value.title,invite_link:l.value.invite_link,reward:0,is_available:!0,available:!0,channel_avatar:"",is_whale:!1,user_id:0};e.rewardChannel(u).then(()=>{if(console.log("request finished"),p.value=!1,e.channels){var w=e.channels.findIndex(r=>r.id==l.value.id);e.channels[w].is_available=!1}l.value.status="",l.value.createdAt=""})}else $().showAlert(o("earn.waitRewardText"))},b=A("visible"),P=()=>{console.log(11111111),b.value="create",p.value=!0},v=A({title:"",link:"",rewared:0});function q(t){return/^(https?:\/\/)?(www\.)?t\.me\/[a-zA-Z0-9_]{5,}$/.test(t)}async function Y(){if(!(v.value.title===""||v.value.link===""||v.value.rewared===0)){if(!q(v.value.link)){console.error("Invalid Telegram URL format"),$().showAlert(o("Invalid Telegram URL format"));return}if(e.channels!=null&&e.channels.findIndex(i=>i.user_id==y.value)!=-1){$().showAlert(o("Вы не можете создать больше 1 кита"));return}e.createWhale(v.value.title,v.value.link,v.value.rewared).then(t=>{t&&(T(),p.value=!1)})}}const K=t=>{t.target.blur()},O=t=>{var h;const i=(h=e.whales)==null?void 0:h.findIndex(u=>u.id==t);i!=-1&&i!=null&&e.whales!=null&&e.whales[i].id==t&&e.changeChannelAvailable(t).then(u=>{u&&(p.value=!1,T())})},Z=t=>{var h;const i=(h=e.whales)==null?void 0:h.findIndex(u=>u.id==t);i!=-1&&i!=null&&e.whales!=null&&e.whales[i].id==t&&e.deleteWhale(t).then(u=>{u&&(p.value=!1,T())})};return(t,i)=>{var u,w,r;const h=ae("click-outside");return d(),c("div",ye,[a("div",we," 🤑 "+f(t.$t("earn.name")),1),a("div",ge,[a("div",ke,[a("div",me," 📢 "+f(t.$t("earn.channels")),1),M.value?(d(),c("div",Ce,[(d(!0),c(W,null,V((u=x(e).channels)==null?void 0:u.filter(s=>!s.is_whale),s=>(d(),c("div",{key:s.id,onClick:I=>s.is_available?U(s,"visible"):x(_).openTelegramLink(s.invite_link),class:"channel"},[a("div",xe,[s.channel_avatar!=""?(d(),c("img",{key:0,src:s.channel_avatar,style:{height:"30px",borderRadius:"100px"}},null,8,Se)):(d(),c("div",Ae,"📢")),a("span",Le,f(s.title),1)]),a("div",Te,[s.is_available?(d(),c("span",Ie,"🍆 "+f(s.reward.toLocaleString()),1)):(d(),c("span",De,"Награда получена")),$e])],8,be))),128))])):C("",!0)]),a("div",null,[a("div",Me,[a("div",Re," 🐳 "+f(t.$t("whales.channels")),1),a("div",{style:{display:"flex",alignItems:"center"},onClick:P},[a("img",{src:x(_e),alt:"Your Icon",style:{height:"45px",marginRight:"7px"}},null,8,je)])]),M.value?(d(),c("div",Ue,[(d(!0),c(W,null,V(x(e).whales,s=>(d(),c("div",{key:s.id,onClick:I=>s.is_available?U(s,"visible"):x(_).openTelegramLink(s.invite_link),class:B(s.available?"channel":"channel-disable")},[a("div",Ve,[s.channel_avatar!=""?(d(),c("img",{key:0,src:s.channel_avatar,style:{height:"30px",borderRadius:"100px"}},null,8,Be)):(d(),c("div",Ge,"🐳")),a("span",Ne,f(s.title),1),s.user_id==y.value?(d(),c("span",Fe,"👑")):C("",!0)]),a("div",ze,[s.is_available?(d(),c("span",Ee,"🍆 "+f(s.reward.toLocaleString()),1)):(d(),c("span",He,"Награда получена")),Pe])],10,We))),128))])):C("",!0)])]),p.value?(d(),c("div",{key:0,class:B(["boost-purchase-popup",{visible:p.value}])},[D((d(),c("div",qe,[a("div",Ye,[a("h2",null,f(b.value=="create"?"Create whale":l.value.title),1),a("button",{class:"close-button",onClick:i[0]||(i[0]=s=>{p.value=!1})},Oe)]),b.value=="visible"&&l.value.owner_id!=y.value?(d(),c("div",Ze,[a("p",null,f(l.value.status=="init"?t.$t("earn.waitRewardText"):t.$t("earn.selectedChannel")),1),a("p",null,"🍆"+f(l.value.reward),1),a("button",{class:"boost-purchase-button",onClick:i[1]||(i[1]=s=>l.value.status=="init"?H():F())},f(l.value.status=="init"?t.$t("earn.getRewardButton"):t.$t("earn.startRewardButton")),1)])):C("",!0),b.value=="visible"&&l.value.owner_id==y.value?(d(),c("div",Je,[Qe,a("p",null,"Награда за переход: 🍆"+f(l.value.reward),1),a("div",Xe,[a("button",{class:"boost-purchase-button",onClick:i[2]||(i[2]=s=>O(l.value.id))},f(l.value.available?"Остановить":"Включить"),1),!l.value.available&&((w=x(L).user)==null?void 0:w.balance)!=null&&((r=x(L).user)==null?void 0:r.balance)<=l.value.reward?(d(),c("button",{key:0,class:"boost-purchase-button",style:{marginTop:"15px"},onClick:i[3]||(i[3]=s=>Z(l.value.id))},"Удалить")):C("",!0)])])):C("",!0),b.value=="create"?(d(),c("div",{key:2,class:"popup-body",onKeydown:ne(K,["enter"]),style:{overflowY:"scroll"}},[a("div",et,[tt,D(a("input",{type:"text",id:"fname",style:{width:"100%"},name:"fname","onUpdate:modelValue":i[4]||(i[4]=s=>v.value.title=s)},null,512),[[j,v.value.title]])]),a("div",st,[at,D(a("input",{type:"text",id:"fname",style:{width:"100%"},name:"fname","onUpdate:modelValue":i[5]||(i[5]=s=>v.value.link=s)},null,512),[[j,v.value.link]])]),a("div",nt,[lt,D(a("input",{type:"number",id:"fname",style:{width:"100%"},name:"fname","onUpdate:modelValue":i[6]||(i[6]=s=>v.value.rewared=s)},null,512),[[j,v.value.rewared]])]),a("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},[a("button",{class:"mypost-button",style:{marginTop:"30px",width:"100%"},onClick:Y},"Создать")])],32)):C("",!0)])),[[h,E]])],2)):C("",!0)])}}}),rt=oe(it,[["__scopeId","data-v-9a106545"]]);export{rt as default};
