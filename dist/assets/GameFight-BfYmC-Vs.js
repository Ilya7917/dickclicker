import{u as P,j as C,k as v,d as I,r as i,o as A,L as D,B as $,b as F,c as T,e as r,D as E,M as G,n as M,x as W,z as j,A as z,_ as L}from"./index-C9bTTGgO.js";const g=P(),O=C("games",{state:()=>({gamesScore:null}),getters:{},actions:{async setUserHP(s){const a=await v.post("https://taptaptap.coinclicker.app/setMatchHP",{hp:s},{headers:{"x-api-key":g.getAccessToken}});return console.log(a),!!a.data.sucess},async getGamesScore(){const s=await v.get("https://taptaptap.coinclicker.app/gamesLeaderBoard",{headers:{"x-api-key":g.getAccessToken}});return console.log(s),this.gamesScore=s.data,s.data},async setUserScore(s,a,c){const d=await v.post("https://taptaptap.coinclicker.app/setUserScore",{isWin:s,enemyID:a,enemyHealth:c},{headers:{"x-api-key":g.getAccessToken}});return console.log(d),!!d.data.sucess},async updateUserHealthDefens(s){const a=await v.post("https://taptaptap.coinclicker.app/setDefensHP",{hp:s},{headers:{"x-api-key":g.getAccessToken}});return console.log(a),!!a.data.sucess}}}),f=s=>(j("data-v-c253723a"),s=s(),z(),s),V=["width","height"],J={id:"unity-loading-bar"},Q=f(()=>r("div",{id:"unity-logo"},null,-1)),q={id:"unity-progress-bar-empty"},K=f(()=>r("div",{id:"unity-webgl-logo"},null,-1)),R=f(()=>r("div",{id:"unity-build-title"},"FlappyDick",-1)),y="/BuildFight",X=I({__name:"GameFight",setup(s){const a=O(),c=P(),d=i("unity-desktop"),w=i(960),_=i(600),k=i("0%"),h=i(!0),S=i(0),b=i(null),u=i(null),p=i(null),U=`${y}/buildes.loader.js`,H={dataUrl:`${y}/buildes.data`,frameworkUrl:`${y}/buildes.framework.js`,codeUrl:`${y}/buildes.wasm`,streamingAssetsUrl:"StreamingAssets",companyName:"DefaultCompany",productName:"FlappyDick",productVersion:"0.1",showBanner:(e,o)=>{if(p.value){const t=document.createElement("div");t.innerHTML=e,p.value.appendChild(t),o==="error"?t.style.background="red":o==="warning"&&(t.style.background="yellow"),t.style.padding="10px",setTimeout(()=>{p.value&&p.value.removeChild(t)},5e3)}}},B=e=>{k.value=`${100*e}%`,e==1&&console.log("load Finish")},N=()=>{var e;(e=u.value)==null||e.SetFullscreen(1)};A(async()=>{var o,t;if(((o=c.user)==null?void 0:o.id)!=null&&(S.value=(t=c.user)==null?void 0:t.id),/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)){const n=document.createElement("meta");n.name="viewport",n.content="width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes",document.getElementsByTagName("head")[0].appendChild(n),d.value="unity-mobile",w.value=window.innerWidth,_.value=window.innerHeight}h.value=!0;const e=document.createElement("script");e.src=U,e.onload=async()=>{try{u.value=await createUnityInstance(b.value,H,B),h.value=!1}catch(n){alert(n)}},document.body.appendChild(e)}),D(()=>{u.value&&u.value.Quit().then(()=>{u.value=null})});const l=i({userHP:0,userName:"",enemyHP:0,enemyName:""}),m=i(0);return window.SetPlayerHP=function(e){if(c.user){if(console.log(e),c.user.balance<e){$().showAlert("Недостаточный баланс");return}a.setUserHP(e).then(o=>{c.user&&(c.user.balance-=e,l.value.userHP=e,o&&a.getGamesScore().then(t=>{if(l.value.userName="Bazil",console.log(t),t!=null&&t.length>0){let n=t.findIndex(x=>x.ID==S.value);n==0||n==-1?(l.value.enemyHP=100,l.value.enemyName="Computer",m.value=-1):(l.value.enemyHP=100,l.value.enemyName=t[n-1].UserName,m.value=t[n-1].UserID)}else l.value.enemyHP=100,l.value.enemyName="Computer",m.value=-1;u.value.SendMessage("LoadCanvas","OnHPWasSet",JSON.stringify(l.value))}))})}},window.SetWinner=function(e){const[o,t]=e.split(",");console.log(o,t),a.setUserScore(o=="Player1",m.value,Number(t)).then(n=>{console.log(n)})},(e,o)=>(F(),T("div",{id:"unity-container",class:W(d.value)},[r("canvas",{id:"unity-canvas",ref_key:"canvas",ref:b,width:w.value,height:_.value,tabindex:"-1"},null,8,V),E(r("div",J,[Q,r("div",q,[r("div",{id:"unity-progress-bar-full",style:M({width:k.value})},null,4)])],512),[[G,h.value]]),r("div",{id:"unity-warning",ref_key:"warningBanner",ref:p},null,512),r("div",{id:"unity-footer"},[K,r("div",{id:"unity-fullscreen-button",onClick:N}),R])],2))}}),Z=L(X,[["__scopeId","data-v-c253723a"]]);export{Z as default};
