import{u as w,j as ee,k as m,D as te,d as ae,l as se,E as ne,g as A,h as le,q as ie,c as r,a as n,t as _,F as B,p as G,b as L,m as y,x as N,v as U,G as W,H as oe,A as C,o as c,y as re,z as ce,_ as ue}from"./index-CM2upm3e.js";const de="/assets/sprite-BbW-irAG.svg",pe=w(),{setUser:ve}=pe,he=ee("channels",{state:()=>({channels:null,whales:null,myChannels:null}),getters:{getChannels:l=>l.myChannels},actions:{async fetchChannels(){const l=w(),i=await m.get("https://taptaptap.coinclicker.app/channels",{headers:{"x-api-key":l.getAccessToken}});console.log(i),this.channels=i.data},async fetchWhales(){const l=w(),i=await m.get("https://taptaptap.coinclicker.app/whales",{headers:{"x-api-key":l.getAccessToken}});this.whales=i.data,console.log(i.data)},async startChannel(l){const i=w(),e=await m.post("https://taptaptap.coinclicker.app/initUserChannel",{id:l.id},{headers:{"x-api-key":i.getAccessToken}});return this.myChannels=e.data.channels,!0},async createWhale(l,i,e){var $;const f=w(),v=await m.post("https://taptaptap.coinclicker.app/createWhale",{balance:l,link:i,rewarded:e},{headers:{"x-api-key":f.getAccessToken}});return console.log(v),v.data.sucess?((($=f.user)==null?void 0:$.balance)!=null&&(f.user.balance-=l),!0):!1},async getMyChannels(){const l=w(),i=await m.get("https://taptaptap.coinclicker.app/getMyChannels",{headers:{"x-api-key":l.getAccessToken}});console.log(i),this.myChannels=te(i.data.channels)},async rewardChannel(l){const i=w(),e=await m.post("https://taptaptap.coinclicker.app/getRewardFromChannel",{id:l.id},{headers:{"x-api-key":i.getAccessToken}});return console.log(e.data),ve(e.data.user),this.myChannels=e.data.channels,!0},async changeChannelAvailable(l){const i=w(),e=await m.post("https://taptaptap.coinclicker.app/changeChannelAvailable",{id:l},{headers:{"x-api-key":i.getAccessToken}});return console.log(e.data),!0},async deleteWhale(l){const i=w(),e=await m.post("https://taptaptap.coinclicker.app/deleteWhale",{id:l},{headers:{"x-api-key":i.getAccessToken}});return console.log(e.data),!0},async topUpWhale(l,i){const e=w(),f=await m.post("https://taptaptap.coinclicker.app/topUpWhale",{id:l,balance:i},{headers:{"x-api-key":e.getAccessToken}});return console.log(f.data),!0}}});function F(l){const i=Object.prototype.toString.call(l);return l instanceof Date||typeof l=="object"&&i==="[object Date]"?new l.constructor(+l):typeof l=="number"||i==="[object Number]"||typeof l=="string"||i==="[object String]"?new Date(l):new Date(NaN)}const fe=36e5;function _e(l){return i=>{const f=(l?Math[l]:Math.trunc)(i);return f===0?0:f}}function ye(l,i){return+F(l)-+F(i)}function we(l,i,e){const f=ye(l,i)/fe;return _e(e==null?void 0:e.roundingMethod)(f)}const ge="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width='80px'%20height='80px'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M15%2012L12%2012M12%2012L9%2012M12%2012L12%209M12%2012L12%2015'%20stroke='%23878787'%20stroke-width='1.5'%20stroke-linecap='round'/%3e%3cpath%20d='M7%203.33782C8.47087%202.48697%2010.1786%202%2012%202C17.5228%202%2022%206.47715%2022%2012C22%2017.5228%2017.5228%2022%2012%2022C6.47715%2022%202%2017.5228%202%2012C2%2010.1786%202.48697%208.47087%203.33782%207'%20stroke='%23878787'%20stroke-width='1.5'%20stroke-linecap='round'/%3e%3c/svg%3e",I=l=>(re("data-v-da91bf6e"),l=l(),ce(),l),P=de+"#chevron-right",be={class:"telegram-channels"},ke={class:"earn-title"},me={style:{display:"flex",flexDirection:"column",justifyContent:"space-between"}},Ce={style:{height:"40vh"}},xe={class:"channels-title"},Ae={key:0,class:"channels-list"},Te=["onClick"],Se={class:"channel-info",style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"}},Le=["src"],Ie={key:1,style:{height:"30px",width:"30px",borderRadius:"100px",background:"gray",justifyContent:"center",alignItems:"center",display:"flex"}},$e={class:"name",style:{marginLeft:"10px"}},De={class:"channel-action"},Me={key:0,class:"reward"},Ue={key:1},Re=I(()=>n("svg",{class:"arrow"},[n("use",{"xlink:href":P})],-1)),We={style:{display:"flex",justifyContent:"space-between"}},je={class:"channels-title"},Ve=["src"],Be={key:0,class:"channels-list",style:{height:"40vh",overflowY:"scroll"}},Ge=["onClick"],Ne={class:"channel-info",style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"}},Fe=["src"],Pe={key:1,style:{height:"30px",width:"30px",borderRadius:"100px",background:"gray",justifyContent:"center",alignItems:"center",display:"flex"}},ze={class:"name",style:{marginLeft:"10px"}},Ee={key:2},He={class:"channel-action"},qe={key:0,class:"reward"},Ye={key:1},Ke=I(()=>n("svg",{class:"arrow"},[n("use",{"xlink:href":P})],-1)),Oe={class:"popup-content"},Ze={class:"popup-header"},Je=I(()=>n("svg",{class:"close-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 30 30",width:"16px",height:"16px"},[n("path",{d:"M 7 4 C 6.744125 4 6.4879687 4.0974687 6.2929688 4.2929688 L 4.2929688 6.2929688 C 3.9019687 6.6839688 3.9019687 7.3170313 4.2929688 7.7070312 L 11.585938 15 L 4.2929688 22.292969 C 3.9019687 22.683969 3.9019687 23.317031 4.2929688 23.707031 L 6.2929688 25.707031 C 6.6839688 26.098031 7.3170313 26.098031 7.7070312 25.707031 L 15 18.414062 L 22.292969 25.707031 C 22.682969 26.098031 23.317031 26.098031 23.707031 25.707031 L 25.707031 23.707031 C 26.098031 23.316031 26.098031 22.682969 25.707031 22.292969 L 18.414062 15 L 25.707031 7.7070312 C 26.098031 7.3170312 26.098031 6.6829688 25.707031 6.2929688 L 23.707031 4.2929688 C 23.316031 3.9019687 22.682969 3.9019687 22.292969 4.2929688 L 15 11.585938 L 7.7070312 4.2929688 C 7.5115312 4.0974687 7.255875 4 7 4 z"})],-1)),Qe=[Je],Xe={key:0,class:"popup-body"},et={key:1,class:"popup-body"},tt={key:0},at={key:1},st={key:2},nt={key:3,style:{marginTop:"15px"}},lt={key:4,style:{marginTop:"15px"}},it=I(()=>n("span",null,"Насколько желаете пополнить кита?🐳",-1)),ot={style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},rt=I(()=>n("label",{for:"fname"},"Баланс кита",-1)),ct={style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},ut=I(()=>n("label",{for:"fname"},"Цена за переход",-1)),dt={style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},pt=I(()=>n("label",{for:"fname"},"Ссылка на канал",-1)),vt=ae({__name:"Channels",setup(l){const{t:i}=se(),e=he(),f=ne(),v=A(!1),$=A(!1),x=w(),g=A(5879286931),o=A({id:0,title:"",reward:0,balance:0,invite_link:"",status:"",createdAt:"",owner_id:0,available:!1,is_available:!1}),D=()=>{e.fetchChannels().then(()=>{e.getMyChannels().then(()=>{var s,d,p,b;((s=e.myChannels)==null?void 0:s.length)!=null&&((d=e.myChannels)==null?void 0:d.length)>0&&((p=e.myChannels)==null||p.map(u=>{var t,R;if(console.log(u),u.Status=="init"){let k=(t=e.channels)==null?void 0:t.findIndex(j=>j.id==u.ChannelID);e.channels&&k!=null&&k!=-1&&(e.channels[k].is_available=!0,console.log(e.channels[k].is_available))}if(u.Status=="rewarded"){let k=(R=e.channels)==null?void 0:R.findIndex(j=>j.id==u.ChannelID);e.channels&&k!=null&&k!=-1&&(e.channels[k].is_available=!1,console.log(e.channels[k].is_available))}}));let a=[];(b=e.channels)==null||b.map(u=>{u.is_whale&&a.push(u)}),e.whales=a.length>0?a:[],a.sort((u,t)=>u.user_id===g.value&&t.user_id!==g.value?-1:u.user_id!==g.value&&t.user_id===g.value?1:u.available&&!t.available?-1:!u.available&&t.available?1:u.is_available&&!t.is_available?-1:!u.is_available&&t.is_available?1:0),console.log(e.whales),$.value=!0})})};le(()=>{var a,s;D(),((a=x.user)==null?void 0:a.id)!=null&&(g.value=(s=x.user)==null?void 0:s.id)});const V=(a,s)=>{var d,p,b;if(!a.available&&a.user_id!=g.value){console.log("channel is not available"),C().showAlert(i("У кита закончился баланс 🍆")),f.openTelegramLink(a.invite_link);return}if(((d=e.myChannels)==null?void 0:d.length)!=null&&((p=e.myChannels)==null?void 0:p.length)>0){let u=e.myChannels.findIndex(t=>t.ChannelID==a.id);console.log(u),u!=-1?(o.value.status=e.myChannels[u].Status,o.value.createdAt=((b=e.myChannels[u].CreatedAt)==null?void 0:b.toLocaleString())||""):(o.value.status="",o.value.createdAt="")}console.log(e.myChannels),o.value.id=a.id,o.value.balance=a.balance,o.value.owner_id=a.user_id,o.value.reward=a.reward,o.value.title=a.title,o.value.invite_link=a.invite_link,o.value.available=a.available,o.value.is_available=a.is_available,v.value=!1,T.value=s,setTimeout(E,100)},z=()=>{const a={id:o.value.id,title:o.value.title,invite_link:o.value.invite_link,available:!0,reward:0,balance:0,is_available:!0,channel_avatar:"",is_whale:!1,user_id:0};e.startChannel(a).then(s=>{if(s){v.value=!1,e.getMyChannels();try{f.openTelegramLink(o.value.invite_link)}catch{console.log("Err")}}})},E=()=>{v.value=!0};function H(){T.value!="create"&&(v.value=!1)}const q=()=>{console.log("check time: "+o.value.createdAt);const a=new Date(o.value.createdAt),d=we(new Date,a);if(console.log("check time: "+o.value.createdAt),console.log("Hours since request: "+d),d>=1){const p={id:o.value.id,title:o.value.title,invite_link:o.value.invite_link,reward:0,is_available:!0,available:!0,balance:0,channel_avatar:"",is_whale:!1,user_id:0};e.rewardChannel(p).then(()=>{if(console.log("request finished"),v.value=!1,e.channels){var b=e.channels.findIndex(u=>u.id==o.value.id);e.channels[b].is_available=!1}o.value.status="",o.value.createdAt=""})}else C().showAlert(i("earn.waitRewardText"))},T=A("visible"),Y=()=>{console.log(11111111),T.value="create",v.value=!0},h=A({balance:0,link:"",rewared:0});function K(a){return/^(https?:\/\/)?(www\.)?t\.me\/[a-zA-Z0-9_]{5,}$/.test(a)}async function O(){var a;if(!(h.value.link===""||h.value.rewared==0)){if(!K(h.value.link)){console.error("Invalid Telegram URL format"),C().showAlert(i("Invalid Telegram URL format"));return}if(x.user!=null&&h.value.balance>((a=x.user)==null?void 0:a.balance)){C().showAlert(i("У вас недостаточно 🍆 чтобы поместить их в кита"));return}if(h.value.balance==0){C().showAlert(i("Баланс кита не может быть 0"));return}if(h.value.rewared>h.value.balance){C().showAlert(i("❌ Вы не можете выдавать юзерам больше, чем будет на балансе кита ❌"));return}if(e.channels!=null&&e.channels.findIndex(d=>d.user_id==g.value)!=-1){C().showAlert(i("Вы не можете создать больше 1 кита"));return}e.createWhale(h.value.balance,h.value.link,h.value.rewared).then(s=>{s&&(D(),v.value=!1)})}}const Z=a=>{a.target.blur()},J=a=>{var d;const s=(d=e.whales)==null?void 0:d.findIndex(p=>p.id==a);s!=-1&&s!=null&&e.whales!=null&&e.whales[s].id==a&&e.changeChannelAvailable(a).then(p=>{p&&(v.value=!1,D())})},Q=a=>{var d;const s=(d=e.whales)==null?void 0:d.findIndex(p=>p.id==a);s!=-1&&s!=null&&e.whales!=null&&e.whales[s].id==a&&e.deleteWhale(a).then(p=>{p&&(v.value=!1,D())})},S=A("view"),M=A(0),X=a=>{if(x.user!=null){if(M.value==0){C().showAlert(i("Нельзя пополнить на 0 🍆"));return}if(x.user.balance<M.value){C().showAlert(i("У вас недостаточно 🍆 чтобы поместить их в кита"));return}e.topUpWhale(a,M.value).then(s=>{s&&(v.value=!1,S.value="view",D())})}};return(a,s)=>{var p,b,u;const d=ie("click-outside");return c(),r("div",be,[n("div",ke," 🤑 "+_(a.$t("earn.name")),1),n("div",me,[n("div",Ce,[n("div",xe," 📢 "+_(a.$t("earn.channels")),1),$.value?(c(),r("div",Ae,[(c(!0),r(B,null,G((p=L(e).channels)==null?void 0:p.filter(t=>!t.is_whale),t=>(c(),r("div",{key:t.id,onClick:R=>t.is_available?V(t,"visible"):L(f).openTelegramLink(t.invite_link),class:"channel"},[n("div",Se,[t.channel_avatar!=""?(c(),r("img",{key:0,src:t.channel_avatar,style:{height:"30px",borderRadius:"100px"}},null,8,Le)):(c(),r("div",Ie,"📢")),n("span",$e,_(t.title),1)]),n("div",De,[t.is_available?(c(),r("span",Me,"🍆 "+_(t.reward.toLocaleString()),1)):(c(),r("span",Ue,"Награда получена")),Re])],8,Te))),128))])):y("",!0)]),n("div",null,[n("div",We,[n("div",je," 🐳 "+_(a.$t("whales.channels")),1),n("div",{style:{display:"flex",alignItems:"center"},onClick:Y},[n("img",{src:L(ge),alt:"Your Icon",style:{height:"45px",marginRight:"7px"}},null,8,Ve)])]),$.value?(c(),r("div",Be,[(c(!0),r(B,null,G(L(e).whales,t=>(c(),r("div",{key:t.id,onClick:R=>t.is_available?V(t,"visible"):L(f).openTelegramLink(t.invite_link),class:N(t.available?"channel":"channel-disable")},[n("div",Ne,[t.channel_avatar!=""?(c(),r("img",{key:0,src:t.channel_avatar,style:{height:"30px",borderRadius:"100px"}},null,8,Fe)):(c(),r("div",Pe,"🐳")),n("span",ze,_(t.title),1),t.user_id==g.value?(c(),r("span",Ee,"👑")):y("",!0)]),n("div",He,[t.is_available?(c(),r("span",qe,"🍆 "+_(t.reward.toLocaleString()),1)):(c(),r("span",Ye,"Награда получена")),Ke])],10,Ge))),128))])):y("",!0)])]),v.value?(c(),r("div",{key:0,class:N(["boost-purchase-popup",{visible:v.value}])},[U((c(),r("div",Oe,[n("div",Ze,[n("h2",null,_(T.value=="create"?"Create whale":o.value.title),1),n("button",{class:"close-button",onClick:s[0]||(s[0]=t=>{v.value=!1})},Qe)]),T.value=="visible"&&o.value.owner_id!=g.value?(c(),r("div",Xe,[n("p",null,_(o.value.status=="init"?a.$t("earn.waitRewardText"):a.$t("earn.selectedChannel")),1),n("p",null,"🍆"+_(o.value.reward),1),n("button",{class:"boost-purchase-button",onClick:s[1]||(s[1]=t=>o.value.status=="init"?q():z())},_(o.value.status=="init"?a.$t("earn.getRewardButton"):a.$t("earn.startRewardButton")),1)])):y("",!0),T.value=="visible"&&o.value.owner_id==g.value?(c(),r("div",et,[S.value=="view"?(c(),r("p",tt,"Этот канал принадлежит вам")):y("",!0),S.value=="view"?(c(),r("p",at,"Награда за переход: 🍆"+_(o.value.reward),1)):y("",!0),S.value=="view"?(c(),r("p",st,"Оставшийся баланс кита: 🍆"+_(o.value.balance),1)):y("",!0),S.value=="view"?(c(),r("div",nt,[n("button",{class:"boost-purchase-button",onClick:s[2]||(s[2]=t=>J(o.value.id))},_(o.value.available?"Остановить":"Включить"),1),n("button",{class:"boost-purchase-button",onClick:s[3]||(s[3]=t=>S.value="topUp"),style:{marginTop:"15px"}},"Пополнить"),!o.value.available&&((b=L(x).user)==null?void 0:b.balance)!=null&&((u=L(x).user)==null?void 0:u.balance)<=o.value.reward?(c(),r("button",{key:0,class:"boost-purchase-button",style:{marginTop:"15px"},onClick:s[4]||(s[4]=t=>Q(o.value.id))},"Удалить")):y("",!0)])):(c(),r("div",lt,[it,U(n("input",{type:"number",id:"fname",style:{width:"100%"},name:"fname","onUpdate:modelValue":s[5]||(s[5]=t=>M.value=t)},null,512),[[W,M.value]]),n("button",{class:"boost-purchase-button",onClick:s[6]||(s[6]=t=>X(o.value.id)),style:{marginTop:"15px"}},"Пополнить"),n("button",{class:"boost-purchase-button",onClick:s[7]||(s[7]=t=>S.value="view"),style:{marginTop:"15px"}},"Назад")]))])):y("",!0),T.value=="create"?(c(),r("div",{key:2,class:"popup-body",onKeydown:oe(Z,["enter"]),style:{overflowY:"scroll"}},[n("div",ot,[rt,U(n("input",{type:"number",id:"fname",style:{width:"100%"},name:"fname","onUpdate:modelValue":s[8]||(s[8]=t=>h.value.balance=t)},null,512),[[W,h.value.balance]])]),n("div",ct,[ut,U(n("input",{type:"number",id:"fname",style:{width:"100%"},name:"fname","onUpdate:modelValue":s[9]||(s[9]=t=>h.value.rewared=t)},null,512),[[W,h.value.rewared]])]),n("div",dt,[pt,U(n("input",{type:"text",id:"fname",style:{width:"100%"},name:"fname","onUpdate:modelValue":s[10]||(s[10]=t=>h.value.link=t)},null,512),[[W,h.value.link]])]),n("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},[n("button",{class:"mypost-button",style:{marginTop:"30px",width:"100%"},onClick:O},"Создать")])],32)):y("",!0)])),[[d,H]])],2)):y("",!0)])}}}),ft=ue(vt,[["__scopeId","data-v-da91bf6e"]]);export{ft as default};
