import{u as y,j as Y,k as m,D as K,d as O,l as Z,E as J,g as k,h as Q,q as X,c,a as t,t as p,F as j,p as U,b as T,m as b,x as V,v as S,G as ee,H as D,A as I,o as d,y as te,z as se,_ as ae}from"./index-DzZQ7W04.js";const ne="/assets/sprite-BbW-irAG.svg",le=y(),{setUser:oe}=le,ie=Y("channels",{state:()=>({channels:null,whales:null,myChannels:null}),getters:{getChannels:s=>s.myChannels},actions:{async fetchChannels(){const s=y(),l=await m.get("https://taptaptap.coinclicker.app/channels",{headers:{"x-api-key":s.getAccessToken}});this.channels=l.data},async fetchWhales(){const s=y(),l=await m.get("https://taptaptap.coinclicker.app/whales",{headers:{"x-api-key":s.getAccessToken}});this.whales=l.data,console.log(l.data)},async startChannel(s){const l=y(),e=await m.post("https://taptaptap.coinclicker.app/initUserChannel",{id:s.id},{headers:{"x-api-key":l.getAccessToken}});return this.myChannels=e.data.channels,!0},async createWhale(s,l,e){const w=y(),u=await m.post("https://taptaptap.coinclicker.app/createWhale",{title:s,link:l,rewarded:e},{headers:{"x-api-key":w.getAccessToken}});return console.log(u),!!u.data.sucess},async getMyChannels(){const s=y(),l=await m.get("https://taptaptap.coinclicker.app/getMyChannels",{headers:{"x-api-key":s.getAccessToken}});console.log(l),this.myChannels=K(l.data.channels)},async rewardChannel(s){const l=y(),e=await m.post("https://taptaptap.coinclicker.app/getRewardFromChannel",{id:s.id},{headers:{"x-api-key":l.getAccessToken}});return console.log(e.data),oe(e.data.user),this.myChannels=e.data.channels,!0}}});function B(s){const l=Object.prototype.toString.call(s);return s instanceof Date||typeof s=="object"&&l==="[object Date]"?new s.constructor(+s):typeof s=="number"||l==="[object Number]"||typeof s=="string"||l==="[object String]"?new Date(s):new Date(NaN)}const re=36e5;function ce(s){return l=>{const w=(s?Math[s]:Math.trunc)(l);return w===0?0:w}}function de(s,l){return+B(s)-+B(l)}function ue(s,l,e){const w=de(s,l)/re;return ce(e==null?void 0:e.roundingMethod)(w)}const he="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width='80px'%20height='80px'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M15%2012L12%2012M12%2012L9%2012M12%2012L12%209M12%2012L12%2015'%20stroke='%23878787'%20stroke-width='1.5'%20stroke-linecap='round'/%3e%3cpath%20d='M7%203.33782C8.47087%202.48697%2010.1786%202%2012%202C17.5228%202%2022%206.47715%2022%2012C22%2017.5228%2017.5228%2022%2012%2022C6.47715%2022%202%2017.5228%202%2012C2%2010.1786%202.48697%208.47087%203.33782%207'%20stroke='%23878787'%20stroke-width='1.5'%20stroke-linecap='round'/%3e%3c/svg%3e",C=s=>(te("data-v-2e75aec6"),s=s(),se(),s),W=ne+"#chevron-right",pe={class:"telegram-channels"},ve={class:"earn-title"},fe={style:{display:"flex",flexDirection:"column",justifyContent:"space-between"}},_e={style:{height:"40vh"}},we={class:"channels-title"},ye={key:0,class:"channels-list"},ge=["onClick"],me={class:"channel-info"},Ce={class:"name"},ke={class:"channel-action"},be={key:0,class:"reward"},xe={key:1},Se=C(()=>t("svg",{class:"arrow"},[t("use",{"xlink:href":W})],-1)),Le={style:{display:"flex",justifyContent:"space-between"}},Ae={class:"channels-title"},Te=["src"],De={key:0,class:"channels-list",style:{height:"40vh",overflowY:"scroll"}},Ie=["onClick"],Me={class:"channel-info"},$e={class:"name"},Re={class:"channel-action"},je={key:0,class:"reward"},Ue={key:1},Ve=C(()=>t("svg",{class:"arrow"},[t("use",{"xlink:href":W})],-1)),Be={class:"popup-content"},We={class:"popup-header"},Ge=C(()=>t("svg",{class:"close-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 30 30",width:"16px",height:"16px"},[t("path",{d:"M 7 4 C 6.744125 4 6.4879687 4.0974687 6.2929688 4.2929688 L 4.2929688 6.2929688 C 3.9019687 6.6839688 3.9019687 7.3170313 4.2929688 7.7070312 L 11.585938 15 L 4.2929688 22.292969 C 3.9019687 22.683969 3.9019687 23.317031 4.2929688 23.707031 L 6.2929688 25.707031 C 6.6839688 26.098031 7.3170313 26.098031 7.7070312 25.707031 L 15 18.414062 L 22.292969 25.707031 C 22.682969 26.098031 23.317031 26.098031 23.707031 25.707031 L 25.707031 23.707031 C 26.098031 23.316031 26.098031 22.682969 25.707031 22.292969 L 18.414062 15 L 25.707031 7.7070312 C 26.098031 7.3170312 26.098031 6.6829688 25.707031 6.2929688 L 23.707031 4.2929688 C 23.316031 3.9019687 22.682969 3.9019687 22.292969 4.2929688 L 15 11.585938 L 7.7070312 4.2929688 C 7.5115312 4.0974687 7.255875 4 7 4 z"})],-1)),Ne=[Ge],Ee={key:0,class:"popup-body"},Fe={style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},ze=C(()=>t("label",{for:"fname"},"Название канала",-1)),He={style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},Pe=C(()=>t("label",{for:"fname"},"Ссылка на канал",-1)),qe={style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},Ye=C(()=>t("label",{for:"fname"},"Цена за переход",-1)),Ke=O({__name:"Channels",setup(s){const{t:l}=Z(),e=ie(),w=J(),u=k(!1),L=k(!1),o=k({id:0,title:"",reward:0,invite_link:"",status:"",createdAt:"",available:!1,is_available:!1}),M=()=>{e.fetchChannels().then(()=>{e.getMyChannels().then(()=>{var i,v,f,a;((i=e.myChannels)==null?void 0:i.length)!=null&&((v=e.myChannels)==null?void 0:v.length)>0&&((f=e.myChannels)==null||f.map(r=>{var x,R;if(console.log(r),r.Status=="init"){let _=(x=e.channels)==null?void 0:x.findIndex(A=>A.id==r.ChannelID);e.channels&&_!=null&&_!=-1&&(e.channels[_].is_available=!0,console.log(e.channels[_].is_available))}if(r.Status=="rewarded"){let _=(R=e.channels)==null?void 0:R.findIndex(A=>A.id==r.ChannelID);e.channels&&_!=null&&_!=-1&&(e.channels[_].is_available=!1,console.log(e.channels[_].is_available))}}));let n=[];(a=e.channels)==null||a.map(r=>{r.is_whale&&n.push(r)}),e.whales=n.length>0?n:[],console.log(e.whales),L.value=!0})})};Q(()=>{M()});const $=(n,i)=>{var v,f,a;if(!n.available){console.log("channel is not available"),I().showAlert(l("Канал недоступен"));return}if(((v=e.myChannels)==null?void 0:v.length)!=null&&((f=e.myChannels)==null?void 0:f.length)>0){let r=e.myChannels.findIndex(x=>x.ChannelID==n.id);console.log(r),r!=-1?(o.value.status=e.myChannels[r].Status,o.value.createdAt=((a=e.myChannels[r].CreatedAt)==null?void 0:a.toLocaleString())||""):(o.value.status="",o.value.createdAt="")}console.log(e.myChannels),o.value.id=n.id,o.value.reward=n.reward,o.value.title=n.title,o.value.invite_link=n.invite_link,o.value.available=n.available,o.value.is_available=n.is_available,u.value=!1,g.value=i,setTimeout(N,100)},G=()=>{const n={id:o.value.id,title:o.value.title,invite_link:o.value.invite_link,available:!0,reward:0,is_available:!0,is_whale:!1};e.startChannel(n).then(i=>{if(i){u.value=!1,e.getMyChannels();try{w.openTelegramLink(o.value.invite_link)}catch{console.log("Err")}}})},N=()=>{u.value=!0};function E(){g.value!="create"&&(u.value=!1)}const F=()=>{console.log("check time: "+o.value.createdAt);const n=new Date(o.value.createdAt),v=ue(new Date,n);if(console.log("check time: "+o.value.createdAt),console.log("Hours since request: "+v),v>=1){const f={id:o.value.id,title:o.value.title,invite_link:o.value.invite_link,reward:0,is_available:!0,available:!0,is_whale:!1};e.rewardChannel(f).then(()=>{if(console.log("request finished"),u.value=!1,e.channels){var a=e.channels.findIndex(r=>r.id==o.value.id);e.channels[a].is_available=!1}o.value.status="",o.value.createdAt=""})}else I().showAlert(l("earn.waitRewardText"))},g=k("visible"),z=()=>{console.log(11111111),g.value="create",u.value=!0},h=k({title:"",link:"",rewared:0});function H(n){return/^(https?:\/\/)?(www\.)?t\.me\/[a-zA-Z0-9_]{5,}$/.test(n)}async function P(){if(!(h.value.title===""||h.value.link===""||h.value.rewared===0)){if(!H(h.value.link)){console.error("Invalid Telegram URL format"),I().showAlert(l("Invalid Telegram URL format"));return}e.createWhale(h.value.title,h.value.link,h.value.rewared).then(n=>{n&&(M(),u.value=!1)})}}const q=n=>{n.target.blur()};return(n,i)=>{var f;const v=X("click-outside");return d(),c("div",pe,[t("div",ve," 🤑 "+p(n.$t("earn.name")),1),t("div",fe,[t("div",_e,[t("div",we," 📢 "+p(n.$t("earn.channels")),1),L.value?(d(),c("div",ye,[(d(!0),c(j,null,U((f=T(e).channels)==null?void 0:f.filter(a=>!a.is_whale),a=>(d(),c("div",{key:a.id,onClick:r=>a.is_available?$(a,"visible"):null,class:"channel"},[t("div",me,[t("span",Ce,p(a.title),1)]),t("div",ke,[a.is_available?(d(),c("span",be,"🍆 "+p(a.reward.toLocaleString()),1)):(d(),c("span",xe,"Награда получена")),Se])],8,ge))),128))])):b("",!0)]),t("div",null,[t("div",Le,[t("div",Ae," 🐳 "+p(n.$t("whales.channels")),1),t("div",{style:{display:"flex",alignItems:"center"},onClick:z},[t("img",{src:T(he),alt:"Your Icon",style:{height:"45px",marginRight:"7px"}},null,8,Te)])]),L.value?(d(),c("div",De,[(d(!0),c(j,null,U(T(e).whales,a=>(d(),c("div",{key:a.id,onClick:r=>a.is_available?$(a,"visible"):null,class:V(a.available?"channel":"channel-disable")},[t("div",Me,[t("span",$e,p(a.title),1)]),t("div",Re,[a.is_available?(d(),c("span",je,"🍆 "+p(a.reward.toLocaleString()),1)):(d(),c("span",Ue,"Награда получена")),Ve])],10,Ie))),128))])):b("",!0)])]),u.value?(d(),c("div",{key:0,class:V(["boost-purchase-popup",{visible:u.value}])},[S((d(),c("div",Be,[t("div",We,[t("h2",null,p(g.value=="create"?"Create whale":"Earn coins"),1),t("button",{class:"close-button",onClick:i[0]||(i[0]=a=>{u.value=!1})},Ne)]),g.value=="visible"?(d(),c("div",Ee,[t("p",null,p(o.value.status=="init"?n.$t("earn.waitRewardText"):n.$t("earn.selectedChannel")),1),t("p",null,"🍆"+p(o.value.reward),1),t("button",{class:"boost-purchase-button",onClick:i[1]||(i[1]=a=>o.value.status=="init"?F():G())},p(o.value.status=="init"?n.$t("earn.getRewardButton"):n.$t("earn.startRewardButton")),1)])):b("",!0),g.value=="create"?(d(),c("div",{key:1,class:"popup-body",onKeydown:ee(q,["enter"]),style:{overflowY:"scroll"}},[t("div",Fe,[ze,S(t("input",{type:"text",id:"fname",style:{width:"100%"},name:"fname","onUpdate:modelValue":i[2]||(i[2]=a=>h.value.title=a)},null,512),[[D,h.value.title]])]),t("div",He,[Pe,S(t("input",{type:"text",id:"fname",style:{width:"100%"},name:"fname","onUpdate:modelValue":i[3]||(i[3]=a=>h.value.link=a)},null,512),[[D,h.value.link]])]),t("div",qe,[Ye,S(t("input",{type:"number",id:"fname",style:{width:"100%"},name:"fname","onUpdate:modelValue":i[4]||(i[4]=a=>h.value.rewared=a)},null,512),[[D,h.value.rewared]])]),t("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},[t("button",{class:"mypost-button",style:{marginTop:"30px",width:"100%"},onClick:P},"Создать")])],32)):b("",!0)])),[[v,E]])],2)):b("",!0)])}}}),Ze=ae(Ke,[["__scopeId","data-v-2e75aec6"]]);export{Ze as default};
