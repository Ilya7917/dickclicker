import{u as H,j as A,k as g,d as D,r as o,o as $,L as F,B as T,b as G,c as j,e as l,D as M,M as E,n as W,x as z,z as L,A as O,_ as V}from"./index-DTCJbcod.js";const y=H(),J=A("games",{state:()=>({gamesScore:null}),getters:{},actions:{async setUserHP(s){const n=await g.post("https://taptaptap.coinclicker.app/setMatchHP",{hp:s},{headers:{"x-api-key":y.getAccessToken}});return console.log(n),!!n.data.sucess},async getGamesScore(){const s=await g.get("https://taptaptap.coinclicker.app/gamesLeaderBoard",{headers:{"x-api-key":y.getAccessToken}});return console.log(s),this.gamesScore=s.data,s.data},async setUserScore(s,n,r){const d=await g.post("https://taptaptap.coinclicker.app/setUserScore",{isWin:s,enemyID:n,enemyHealth:r},{headers:{"x-api-key":y.getAccessToken}});return console.log(d),!!d.data.sucess},async updateUserHealthDefens(s){const n=await g.post("https://taptaptap.coinclicker.app/setDefensHP",{hp:s},{headers:{"x-api-key":y.getAccessToken}});return console.log(n),!!n.data.sucess}}}),w=s=>(L("data-v-f696488c"),s=s(),O(),s),Q=["width","height"],q={id:"unity-loading-bar"},K=w(()=>l("div",{id:"unity-logo"},null,-1)),R={id:"unity-progress-bar-empty"},X=w(()=>l("div",{id:"unity-webgl-logo"},null,-1)),Y=w(()=>l("div",{id:"unity-build-title"},"FlappyDick",-1)),h="/BuildFight",Z=D({__name:"GameFight",setup(s){const n=J(),r=H(),d=o("unity-desktop"),_=o(960),S=o(600),k=o("0%"),f=o(!0),b=o(0),P=o(null),u=o(null),p=o(null),B=`${h}/buildes.loader.js`,N={dataUrl:`${h}/buildes.data`,frameworkUrl:`${h}/buildes.framework.js`,codeUrl:`${h}/buildes.wasm`,streamingAssetsUrl:"StreamingAssets",companyName:"DefaultCompany",productName:"FlappyDick",productVersion:"0.1",showBanner:(e,a)=>{if(p.value){const t=document.createElement("div");t.innerHTML=e,p.value.appendChild(t),a==="error"?t.style.background="red":a==="warning"&&(t.style.background="yellow"),t.style.padding="10px",setTimeout(()=>{p.value&&p.value.removeChild(t)},5e3)}}},x=e=>{k.value=`${100*e}%`,e==1&&console.log("load Finish")},C=()=>{var e;(e=u.value)==null||e.SetFullscreen(1)};$(async()=>{var a,t;if(((a=r.user)==null?void 0:a.id)!=null&&(b.value=(t=r.user)==null?void 0:t.id),/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)){const i=document.createElement("meta");i.name="viewport",i.content="width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes",document.getElementsByTagName("head")[0].appendChild(i),d.value="unity-mobile",_.value=window.innerWidth,S.value=window.innerHeight}f.value=!0;const e=document.createElement("script");e.src=B,e.onload=async()=>{try{u.value=await createUnityInstance(P.value,N,x),f.value=!1}catch(i){alert(i)}},document.body.appendChild(e)}),F(()=>{u.value&&u.value.Quit().then(()=>{u.value=null})});const c=o({userHP:0,userName:"",enemyHP:0,enemyName:""}),m=o(0);return window.SetPlayerHP=function(e){if(r.user){if(console.log(e),r.user.balance<e){T().showAlert("Недостаточный баланс");return}n.setUserHP(e).then(a=>{r.user&&(r.user.balance-=e,c.value.userHP=e,a&&n.getGamesScore().then(t=>{var i,U;if(c.value.userName=((i=r.user)==null?void 0:i.first_name)!=null?(U=r.user)==null?void 0:U.first_name:"",console.log(t),t!=null&&t.length>0){let v=t.findIndex(I=>I.ID==b.value);v==0||v==-1?(c.value.enemyHP=100,c.value.enemyName="Computer",m.value=-1):(c.value.enemyHP=100,c.value.enemyName=t[v-1].UserName,m.value=t[v-1].UserID)}else c.value.enemyHP=100,c.value.enemyName="Computer",m.value=-1;u.value.SendMessage("LoadCanvas","OnHPWasSet",JSON.stringify(c.value))}))})}},window.SetWinner=function(e){const[a,t]=e.split(",");console.log(a,t),n.setUserScore(a=="Player1",m.value,Number(t)).then(i=>{console.log(i)})},(e,a)=>(G(),j("div",{id:"unity-container",class:z(d.value)},[l("canvas",{id:"unity-canvas",ref_key:"canvas",ref:P,width:_.value,height:S.value,tabindex:"-1"},null,8,Q),M(l("div",q,[K,l("div",R,[l("div",{id:"unity-progress-bar-full",style:W({width:k.value})},null,4)])],512),[[E,f.value]]),l("div",{id:"unity-warning",ref_key:"warningBanner",ref:p},null,512),l("div",{id:"unity-footer"},[X,l("div",{id:"unity-fullscreen-button",onClick:C}),Y])],2))}}),ee=V(Z,[["__scopeId","data-v-f696488c"]]),se=Object.freeze(Object.defineProperty({__proto__:null,default:ee},Symbol.toStringTag,{value:"Module"}));export{ee as G,se as a,J as u};
