import{u as g,j as le,k as T,D as ie,d as oe,l as re,E as ue,g as m,h as ce,q as de,c as r,a as s,t as _,F as G,p as E,v as I,G as $,m as h,e as D,x as F,H as ve,A as w,o as u,y as pe,z as he,_ as fe}from"./index-DxiSpDPG.js";const ye="/assets/sprite-BbW-irAG.svg",_e=g(),{setUser:we}=_e,me=le("channels",{state:()=>({channels:null,whales:null,myChannels:null}),getters:{getChannels:i=>i.myChannels},actions:{async fetchChannels(){const i=g(),l=await T.get("https://taptaptap.coinclicker.app/channels",{headers:{"x-api-key":i.getAccessToken}});console.log(l),this.channels=l.data},async fetchWhales(){const i=g(),l=await T.get("https://taptaptap.coinclicker.app/whales",{headers:{"x-api-key":i.getAccessToken}});this.whales=l.data,console.log(l.data)},async startChannel(i){const l=g(),t=await T.post("https://taptaptap.coinclicker.app/initUserChannel",{id:i.id},{headers:{"x-api-key":l.getAccessToken}});return this.myChannels=t.data.channels,!0},async createWhale(i,l,t){var U;const f=g(),y=await T.post("https://taptaptap.coinclicker.app/createWhale",{balance:i,link:l,rewarded:t},{headers:{"x-api-key":f.getAccessToken}});return console.log(y),y.data.sucess?(((U=f.user)==null?void 0:U.balance)!=null&&(f.user.balance-=i),!0):!1},async getMyChannels(){const i=g(),l=await T.get("https://taptaptap.coinclicker.app/getMyChannels",{headers:{"x-api-key":i.getAccessToken}});console.log(l),this.myChannels=ie(l.data.channels)},async rewardChannel(i){const l=g(),t=await T.post("https://taptaptap.coinclicker.app/getRewardFromChannel",{id:i.id},{headers:{"x-api-key":l.getAccessToken}});return console.log(t.data),we(t.data.user),this.myChannels=t.data.channels,!0},async changeChannelAvailable(i){const l=g(),t=await T.post("https://taptaptap.coinclicker.app/changeChannelAvailable",{id:i},{headers:{"x-api-key":l.getAccessToken}});return console.log(t.data),!0},async deleteWhale(i){const l=g(),t=await T.post("https://taptaptap.coinclicker.app/deleteWhale",{id:i},{headers:{"x-api-key":l.getAccessToken}});return console.log(t.data),!0},async topUpWhale(i,l){const t=g(),f=await T.post("https://taptaptap.coinclicker.app/topUpWhale",{id:i,balance:l},{headers:{"x-api-key":t.getAccessToken}});return console.log(f.data),!0}}});function K(i){const l=Object.prototype.toString.call(i);return i instanceof Date||typeof i=="object"&&l==="[object Date]"?new i.constructor(+i):typeof i=="number"||l==="[object Number]"||typeof i=="string"||l==="[object String]"?new Date(i):new Date(NaN)}const ge=36e5;function be(i){return l=>{const f=(i?Math[i]:Math.trunc)(l);return f===0?0:f}}function ke(i,l){return+K(i)-+K(l)}function xe(i,l,t){const f=ke(i,l)/ge;return be(t==null?void 0:t.roundingMethod)(f)}const Ce="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width='80px'%20height='80px'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M15%2012L12%2012M12%2012L9%2012M12%2012L12%209M12%2012L12%2015'%20stroke='%23878787'%20stroke-width='1.5'%20stroke-linecap='round'/%3e%3cpath%20d='M7%203.33782C8.47087%202.48697%2010.1786%202%2012%202C17.5228%202%2022%206.47715%2022%2012C22%2017.5228%2017.5228%2022%2012%2022C6.47715%2022%202%2017.5228%202%2012C2%2010.1786%202.48697%208.47087%203.33782%207'%20stroke='%23878787'%20stroke-width='1.5'%20stroke-linecap='round'/%3e%3c/svg%3e",x=i=>(pe("data-v-2c3a9dca"),i=i(),he(),i),O=ye+"#chevron-right",Ae={class:"telegram-channels"},Te={class:"earn-title"},Se={key:0,class:"createPostMenu"},Ie={style:{marginTop:"20px"}},Le={id:"progressbar"},$e={class:"createForm"},De={key:0,style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}},Ue=x(()=>s("label",{for:"fname"},"Ссылка на канал",-1)),je={key:1,style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}},Me=x(()=>s("label",{for:"fname"},"Цена за переход",-1)),Re={key:2,style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}},We=x(()=>s("label",{for:"fname"},"Баланс рекламного канала",-1)),Ve={key:0},Be={key:0,style:{display:"flex",justifyContent:"center"}},Pe={key:1,style:{display:"flex",flexDirection:"column",justifyContent:"space-between"}},Ne={style:{height:"40vh"}},Ge={class:"channels-title"},Ee={key:0,class:"channels-list"},Fe=["onClick"],ze={class:"channel-info",style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"}},He=["src"],qe={key:1,style:{height:"30px",width:"30px",borderRadius:"100px",background:"gray",justifyContent:"center",alignItems:"center",display:"flex"}},Ye={class:"name",style:{marginLeft:"10px"}},Ke={class:"channel-action"},Oe={key:0,class:"reward"},Ze={key:1},Je=x(()=>s("svg",{class:"arrow"},[s("use",{"xlink:href":O})],-1)),Qe={style:{display:"flex",justifyContent:"space-between"}},Xe={class:"channels-title"},et=["src"],tt={key:0,class:"channels-list",style:{height:"40vh",overflowY:"scroll"}},at=["onClick"],st={class:"channel-info",style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"}},nt=["src"],lt={key:1,style:{height:"30px",width:"30px",borderRadius:"100px",background:"gray",justifyContent:"center",alignItems:"center",display:"flex"}},it={class:"name",style:{marginLeft:"10px"}},ot={key:2},rt={class:"channel-action"},ut={key:0,class:"reward"},ct={key:1},dt=x(()=>s("svg",{class:"arrow"},[s("use",{"xlink:href":O})],-1)),vt={class:"popup-content"},pt={class:"popup-header"},ht=x(()=>s("svg",{class:"close-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 30 30",width:"16px",height:"16px"},[s("path",{d:"M 7 4 C 6.744125 4 6.4879687 4.0974687 6.2929688 4.2929688 L 4.2929688 6.2929688 C 3.9019687 6.6839688 3.9019687 7.3170313 4.2929688 7.7070312 L 11.585938 15 L 4.2929688 22.292969 C 3.9019687 22.683969 3.9019687 23.317031 4.2929688 23.707031 L 6.2929688 25.707031 C 6.6839688 26.098031 7.3170313 26.098031 7.7070312 25.707031 L 15 18.414062 L 22.292969 25.707031 C 22.682969 26.098031 23.317031 26.098031 23.707031 25.707031 L 25.707031 23.707031 C 26.098031 23.316031 26.098031 22.682969 25.707031 22.292969 L 18.414062 15 L 25.707031 7.7070312 C 26.098031 7.3170312 26.098031 6.6829688 25.707031 6.2929688 L 23.707031 4.2929688 C 23.316031 3.9019687 22.682969 3.9019687 22.292969 4.2929688 L 15 11.585938 L 7.7070312 4.2929688 C 7.5115312 4.0974687 7.255875 4 7 4 z"})],-1)),ft=[ht],yt={key:0,class:"popup-body"},_t={key:1,class:"popup-body"},wt={key:0},mt={key:1},gt={key:2},bt={key:3,style:{marginTop:"15px"}},kt={key:4,style:{marginTop:"15px"}},xt=x(()=>s("span",null,"Насколько желаете пополнить кита?🐳",-1)),Ct={style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},At=x(()=>s("label",{for:"fname"},"Баланс кита",-1)),Tt={style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},St=x(()=>s("label",{for:"fname"},"Цена за переход",-1)),It={style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},Lt=x(()=>s("label",{for:"fname"},"Ссылка на канал",-1)),$t=oe({__name:"Channels",setup(i){const{t:l}=re(),t=me(),f=ue(),y=m(!1),U=m(!1),S=g(),b=m(5879286931),o=m({id:0,title:"",reward:0,balance:0,invite_link:"",status:"",createdAt:"",owner_id:0,available:!1,is_available:!1}),M=()=>{t.fetchChannels().then(()=>{t.getMyChannels().then(()=>{var a,v,p,k;((a=t.myChannels)==null?void 0:a.length)!=null&&((v=t.myChannels)==null?void 0:v.length)>0&&((p=t.myChannels)==null||p.map(d=>{var e,B;if(console.log(d),d.Status=="init"){let A=(e=t.channels)==null?void 0:e.findIndex(N=>N.id==d.ChannelID);t.channels&&A!=null&&A!=-1&&(t.channels[A].is_available=!0,console.log(t.channels[A].is_available))}if(d.Status=="rewarded"){let A=(B=t.channels)==null?void 0:B.findIndex(N=>N.id==d.ChannelID);t.channels&&A!=null&&A!=-1&&(t.channels[A].is_available=!1,console.log(t.channels[A].is_available))}}));let n=[];(k=t.channels)==null||k.map(d=>{d.is_whale&&n.push(d)}),t.whales=n.length>0?n:[],n.sort((d,e)=>d.user_id===b.value&&e.user_id!==b.value?-1:d.user_id!==b.value&&e.user_id===b.value?1:d.available&&!e.available?-1:!d.available&&e.available?1:d.is_available&&!e.is_available?-1:!d.is_available&&e.is_available?1:0),console.log(t.whales),U.value=!0})})};ce(()=>{var n,a;M(),((n=S.user)==null?void 0:n.id)!=null&&(b.value=(a=S.user)==null?void 0:a.id)});const z=(n,a)=>{var v,p,k;if(!n.available&&n.user_id!=b.value){console.log("channel is not available"),w().showAlert(l("У кита закончился баланс 🍆")),f.openTelegramLink(n.invite_link);return}if(((v=t.myChannels)==null?void 0:v.length)!=null&&((p=t.myChannels)==null?void 0:p.length)>0){let d=t.myChannels.findIndex(e=>e.ChannelID==n.id);console.log(d),d!=-1?(o.value.status=t.myChannels[d].Status,o.value.createdAt=((k=t.myChannels[d].CreatedAt)==null?void 0:k.toLocaleString())||""):(o.value.status="",o.value.createdAt="")}console.log(t.myChannels),o.value.id=n.id,o.value.balance=n.balance,o.value.owner_id=n.user_id,o.value.reward=n.reward,o.value.title=n.title,o.value.invite_link=n.invite_link,o.value.available=n.available,o.value.is_available=n.is_available,y.value=!1,j.value=a,setTimeout(J,100)},Z=()=>{const n={id:o.value.id,title:o.value.title,invite_link:o.value.invite_link,available:!0,reward:0,balance:0,is_available:!0,channel_avatar:"",is_whale:!1,user_id:0};t.startChannel(n).then(a=>{if(a){y.value=!1,t.getMyChannels();try{f.openTelegramLink(o.value.invite_link)}catch{console.log("Err")}}})},J=()=>{y.value=!0};function Q(){j.value!="create"&&(y.value=!1)}const X=()=>{console.log("check time: "+o.value.createdAt);const n=new Date(o.value.createdAt),v=xe(new Date,n);if(console.log("check time: "+o.value.createdAt),console.log("Hours since request: "+v),v>=1){const p={id:o.value.id,title:o.value.title,invite_link:o.value.invite_link,reward:0,is_available:!0,available:!0,balance:0,channel_avatar:"",is_whale:!1,user_id:0};t.rewardChannel(p).then(()=>{if(console.log("request finished"),y.value=!1,t.channels){var k=t.channels.findIndex(d=>d.id==o.value.id);t.channels[k].is_available=!1}o.value.status="",o.value.createdAt=""})}else w().showAlert(l("earn.waitRewardText"))},j=m("visible"),c=m({balance:0,link:"",rewared:0});function H(n){return/^(https?:\/\/)?(www\.)?t\.me\/[a-zA-Z0-9_]{5,}$/.test(n)}async function q(){var n;if(!(c.value.link===""||c.value.rewared==0)){if(!H(c.value.link)){console.error("Invalid Telegram URL format"),w().showAlert(l("Invalid Telegram URL format"));return}if(S.user!=null&&c.value.balance>((n=S.user)==null?void 0:n.balance)){w().showAlert(l("У вас недостаточно 🍆 чтобы поместить их в рекламу канала"));return}if(c.value.balance==0){w().showAlert(l("Баланс кита не может быть 0🍆"));return}if(c.value.balance<1e4){w().showAlert(l("Баланс кита не может быть меньше 10.000🍆"));return}if(c.value.rewared>c.value.balance){w().showAlert(l("❌ Вы не можете выдавать юзерам больше, чем будет на балансе рекламы канала ❌"));return}if(t.channels!=null&&t.channels.findIndex(v=>v.user_id==b.value)!=-1){w().showAlert(l("Вы не можете создать больше 1-ой рекламы канала"));return}V.value=!1,t.createWhale(c.value.balance,c.value.link,c.value.rewared).then(a=>{a?(M(),y.value=!1,V.value=!0,W.value="channels",C.value=0,P.forEach(v=>{v.id!=0&&(v.isActive=!1)})):(w().showAlert(l("🐳 Ошибка при создании канала, попробуйте попытку позже")),V.value=!0)})}}const ee=n=>{n.target.blur()},te=n=>{var v;const a=(v=t.whales)==null?void 0:v.findIndex(p=>p.id==n);a!=-1&&a!=null&&t.whales!=null&&t.whales[a].id==n&&t.changeChannelAvailable(n).then(p=>{p&&(y.value=!1,M())})},ae=n=>{var v;const a=(v=t.whales)==null?void 0:v.findIndex(p=>p.id==n);a!=-1&&a!=null&&t.whales!=null&&t.whales[a].id==n&&t.deleteWhale(n).then(p=>{p&&(y.value=!1,M())})},L=m("view"),R=m(0),se=n=>{if(S.user!=null){if(R.value==0){w().showAlert(l("Нельзя пополнить на 0 🍆"));return}if(S.user.balance<R.value){w().showAlert(l("У вас недостаточно 🍆 чтобы поместить их в рекламу канала"));return}t.topUpWhale(n,R.value).then(a=>{a&&(y.value=!1,L.value="view",M())})}},W=m("channels"),C=m(0),Y=n=>{W.value=n},V=m(!0),P=[{id:0,isActive:!0,text:"Add link"},{id:1,isActive:!1,text:"Price per transition"},{id:2,isActive:!1,text:"Add balance"}],ne=()=>{if(C.value==0&&!H(c.value.link)){w().showAlert(l("Invalid Telegram URL format"));return}if(C.value==1&&c.value.rewared<=0){w().showAlert(l("❌ Цена за переход не может быть меньше 0 ❌"));return}C.value++,P[C.value].isActive=!0};return(n,a)=>{var p,k,d;const v=de("click-outside");return u(),r("div",Ae,[s("div",Te," 🤑 "+_(n.$t("earn.name")),1),W.value==="create"?(u(),r("div",Se,[s("button",{class:"mypost-button",style:{marginTop:"10px"},onClick:a[0]||(a[0]=e=>Y("channels"))},"Назад"),s("div",Ie,[s("ul",Le,[(u(),r(G,null,E(P,e=>s("li",{class:F(e.isActive?"active":"")},_(e.text),3)),64))])]),s("div",$e,[C.value===0?(u(),r("div",De,[Ue,I(s("input",{type:"text",id:"fname",style:{width:"70%",color:"white"},name:"fname","onUpdate:modelValue":a[1]||(a[1]=e=>c.value.link=e)},null,512),[[$,c.value.link]])])):h("",!0),C.value===1?(u(),r("div",je,[Me,I(s("input",{type:"number",id:"fname",style:{width:"70%",color:"white"},name:"fname","onUpdate:modelValue":a[2]||(a[2]=e=>c.value.rewared=e)},null,512),[[$,c.value.rewared]])])):h("",!0),C.value===2?(u(),r("div",Re,[We,I(s("input",{type:"number",id:"fname",style:{width:"70%",color:"white"},name:"fname","onUpdate:modelValue":a[3]||(a[3]=e=>c.value.balance=e)},null,512),[[$,c.value.balance]]),V.value?(u(),r("div",Ve,[s("button",{class:"mypost-button",style:{marginTop:"30px"},onClick:a[4]||(a[4]=e=>q())},"Создать")])):h("",!0)])):h("",!0)]),C.value<2?(u(),r("div",Be,[s("button",{class:"mypost-button",style:{marginTop:"30px"},onClick:ne},"Дальше")])):h("",!0)])):h("",!0),W.value=="channels"?(u(),r("div",Pe,[s("div",Ne,[s("div",Ge," 📢 "+_(n.$t("earn.channels")),1),U.value?(u(),r("div",Ee,[(u(!0),r(G,null,E((p=D(t).channels)==null?void 0:p.filter(e=>!e.is_whale),e=>(u(),r("div",{key:e.id,onClick:B=>e.is_available?z(e,"visible"):D(f).openTelegramLink(e.invite_link),class:"channel"},[s("div",ze,[e.channel_avatar!=""?(u(),r("img",{key:0,src:e.channel_avatar,style:{height:"30px",borderRadius:"100px"}},null,8,He)):(u(),r("div",qe,"📢")),s("span",Ye,_(e.title),1)]),s("div",Ke,[e.is_available?(u(),r("span",Oe,"🍆 "+_(e.reward.toLocaleString()),1)):(u(),r("span",Ze,"Награда получена")),Je])],8,Fe))),128))])):h("",!0)]),s("div",null,[s("div",Qe,[s("div",Xe," 🐳 "+_(n.$t("whales.channels")),1),s("div",{style:{display:"flex",alignItems:"center"},onClick:a[5]||(a[5]=e=>Y("create"))},[s("img",{src:D(Ce),alt:"Your Icon",style:{height:"45px",marginRight:"7px"}},null,8,et)])]),U.value?(u(),r("div",tt,[(u(!0),r(G,null,E(D(t).whales,e=>(u(),r("div",{key:e.id,onClick:B=>e.is_available?z(e,"visible"):D(f).openTelegramLink(e.invite_link),class:F(e.available?"channel":"channel-disable")},[s("div",st,[e.channel_avatar!=""?(u(),r("img",{key:0,src:e.channel_avatar,style:{height:"30px",borderRadius:"100px"}},null,8,nt)):(u(),r("div",lt,"🐳")),s("span",it,_(e.title),1),e.user_id==b.value?(u(),r("span",ot,"👑")):h("",!0)]),s("div",rt,[e.is_available?(u(),r("span",ut,"🍆 "+_(e.reward.toLocaleString()),1)):(u(),r("span",ct,"Награда получена")),dt])],10,at))),128))])):h("",!0)])])):h("",!0),y.value?(u(),r("div",{key:2,class:F(["boost-purchase-popup",{visible:y.value}])},[I((u(),r("div",vt,[s("div",pt,[s("h2",null,_(j.value=="create"?"Create whale":o.value.title),1),s("button",{class:"close-button",onClick:a[6]||(a[6]=e=>{y.value=!1})},ft)]),j.value=="visible"&&o.value.owner_id!=b.value?(u(),r("div",yt,[s("p",null,_(o.value.status=="init"?n.$t("earn.waitRewardText"):n.$t("earn.selectedChannel")),1),s("p",null,"🍆"+_(o.value.reward),1),s("button",{class:"boost-purchase-button",onClick:a[7]||(a[7]=e=>o.value.status=="init"?X():Z())},_(o.value.status=="init"?n.$t("earn.getRewardButton"):n.$t("earn.startRewardButton")),1)])):h("",!0),j.value=="visible"&&o.value.owner_id==b.value?(u(),r("div",_t,[L.value=="view"?(u(),r("p",wt,"Этот канал принадлежит вам")):h("",!0),L.value=="view"?(u(),r("p",mt,"Награда за переход: 🍆"+_(o.value.reward),1)):h("",!0),L.value=="view"?(u(),r("p",gt,"Оставшийся баланс кита: 🍆"+_(o.value.balance),1)):h("",!0),L.value=="view"?(u(),r("div",bt,[s("button",{class:"boost-purchase-button",onClick:a[8]||(a[8]=e=>te(o.value.id))},_(o.value.available?"Остановить":"Включить"),1),s("button",{class:"boost-purchase-button",onClick:a[9]||(a[9]=e=>L.value="topUp"),style:{marginTop:"15px"}},"Пополнить"),!o.value.available&&((k=D(S).user)==null?void 0:k.balance)!=null&&((d=D(S).user)==null?void 0:d.balance)<=o.value.reward?(u(),r("button",{key:0,class:"boost-purchase-button",style:{marginTop:"15px"},onClick:a[10]||(a[10]=e=>ae(o.value.id))},"Удалить")):h("",!0)])):(u(),r("div",kt,[xt,I(s("input",{type:"number",id:"fname",style:{width:"100%"},name:"fname","onUpdate:modelValue":a[11]||(a[11]=e=>R.value=e)},null,512),[[$,R.value]]),s("button",{class:"boost-purchase-button",onClick:a[12]||(a[12]=e=>se(o.value.id)),style:{marginTop:"15px"}},"Пополнить"),s("button",{class:"boost-purchase-button",onClick:a[13]||(a[13]=e=>L.value="view"),style:{marginTop:"15px"}},"Назад")]))])):h("",!0),j.value=="create"?(u(),r("div",{key:2,class:"popup-body",onKeydown:ve(ee,["enter"]),style:{overflowY:"scroll"}},[s("div",Ct,[At,I(s("input",{type:"number",id:"fname",style:{width:"100%"},name:"fname","onUpdate:modelValue":a[14]||(a[14]=e=>c.value.balance=e)},null,512),[[$,c.value.balance]])]),s("div",Tt,[St,I(s("input",{type:"number",id:"fname",style:{width:"100%"},name:"fname","onUpdate:modelValue":a[15]||(a[15]=e=>c.value.rewared=e)},null,512),[[$,c.value.rewared]])]),s("div",It,[Lt,I(s("input",{type:"text",id:"fname",style:{width:"100%"},name:"fname","onUpdate:modelValue":a[16]||(a[16]=e=>c.value.link=e)},null,512),[[$,c.value.link]])]),s("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",marginTop:"30px"}},[s("button",{class:"mypost-button",style:{marginTop:"30px",width:"100%"},onClick:q},"Создать")])],32)):h("",!0)])),[[v,Q]])],2)):h("",!0)])}}}),Ut=fe($t,[["__scopeId","data-v-2c3a9dca"]]);export{Ut as default};
